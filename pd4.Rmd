---
title: "Pr치ctica dirigida 4"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: cosmo
    highlight: textmate
    always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estad칤stica para el an치lisis pol칤tico 1 \| Semestre 2024 - 2 <br>

# **Intervalos de confianza**

Con este tema, nos adentraremos en el estudio de la estad칤stica inferencial, cuyo objetivo es estimar y aproximar los par치metros poblacionales basados en los datos obtenidos de una muestra representativa. A trav칠s de este enfoque, podemos hacer generalizaciones v치lidas sobre una poblaci칩n completa a partir de un subconjunto de datos, permitiendo tomar decisiones y formular conclusiones fundamentadas.

Revisemos algunos conceptos:

-   **Estimador puntual:** un n칰mero que es nuestra predicci칩n del par치metro

-   **Intervalo de confianza (IC):** un intervalo de n칰meros basado en la distribuci칩n de la data observada de la muestra dentro de la cual se cree que estar칤a el par치metro poblacional.

$$IC = \text{estimador puntual} \pm \text{margen de error}$$

-   **Nivel de confianza:** es la probabilidad de que el par치metro se encuentre en ese intervalo.

-   **Margen de error:** mide qu칠 tan precisa es la estimaci칩n del par치metro.

-   **Error de muestreo:** diferencia entre el valor calculado de un estad칤stico y valor real de un par치metro de la poblaci칩n.

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("IC.png") 
```

### Conceptualizaci칩n e Importancia

-   Los intervalos de confianza ofrecen una manera de estimar, con alta probabilidad, un rango de valores en el que se encuentra el valor poblacional (o par치metro) de una determinada variable.
-   El intervalo de confianza describe la variabilidad entre la medida obtenida en un estudio y la medida real de la poblaci칩n (el valor real).
-   Un intervalo de confianza de 90%/95%/99% nos indica que dentro del rango dado se encuentra el valor real de un par치metro con 90%/95%/99% de certeza.
-   Existe una relaci칩n inversa entre la amplitud del IC y el tama침o muestral: mientras m치s peque침o es el n, m치s amplio es el IC. A mayor n, el IC es m치s estrecho.
-   Gracias al IC podemos determinar si la estimaci칩n es representativa de la poblaci칩n.

### Sobre el nivel de confianza

Si tenemos un nivel de confianza de 95%, quiere decir que si realizamos 100 veces el mismo procedimiento de muestreo y calculamos los estad칤sticos de inter칠s, 95 veces obtendremos los resultados en el intervalo calculado. Los mismo ocurrir칤a si realizamos el c치lculo con un 99% de confianza. Al momento de decidir el nivel de confianza debemos tener presente una regla: a mayor nivel de confianza, menor ser치 la precisi칩n ya que el intervalo es m치s amplio.

### **1.Intervalos de confianza para una proporci칩n**

Tengamos en consideraci칩n que para poder hallar el intervalo de confianza para una proporci칩n debemos determinar nuestro caso de 칠xito. Asimismo, para hallar el intervalo de confianza para una proporci칩n nuestra variable debe ser categ칩rica y debe representar una variable dicot칩mica; es decir, una variable con solo dos categor칤as posibles: vot칩/no vot칩; s칤/no, etc.

Recordemos la f칩rmula para hallar el intervalo de confianza para una proporci칩n

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("ICprop.png") 
```
**Ejemplo pr치ctico:**

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("food.png") 
```

Una empresa muy conocida de comida para gatos llamada _Furbys_ desea realizar un relanzamiento de marca. Para ello crean el eslogan "8 de cada 10 gatos prefieren Furbys". Sin embargo, debido a un reclamo de los alumnos del curso de Estad칤stica, esta vez la empresa decide realizar el sustento de su eslogan.


```{r}
library(rio)
cats=import("cats.xlsx")
str(cats)
```
```{r}
table(cats$Furbys)
```

Formateo la variable _Furbys_ 
```{r}
library(dplyr)
cats = cats %>%
  mutate(Furbys = factor(Furbys, levels = c("s칤", "no")))
str(cats) #corroboro que ya cuento con mi categ칩rica
```
```{r}
tablaCats = cats %>%
  filter(Furbys =="s칤" | Furbys == "no") %>%
  count(칄xito = Furbys, name="N") %>%
  mutate(total = sum(N), 
         Porcentaje = N / total * 100)
tablaCats
```
```{r}
prop.test(248,400) #caso de 칠xito y total
```
Con base en los resultados del test de proporciones para una muestra de 400 gatos, se estima que la proporci칩n de gatos que prefieren la marca de comida _Furbys_ est치 entre el 57.02% y el 66.74%, con un intervalo de confianza del 95%. Esto significa que, si se tomaran m칰ltiples muestras aleatorias de la misma poblaci칩n, en aproximadamente el 95% de las ocasiones la proporci칩n verdadera de gatos que prefieren _Furbys_ caer칤a dentro de este rango.

La proporci칩n observada en la muestra es del 62%, lo que sugiere que 6 de cada 10 gatos prefieren _Furbys_. En consecuencia, se puede afirmar con evidencia estad칤stica que una mayor칤a de gatos prefiere esta marca.

Si se deseara utilizar este resultado como base para una campa침a publicitaria, una frase como "6 de cada 10 gatos prefieren Furbys" ser칤a un eslogan adecuado, sustentado en los datos obtenidos.



### **2.Intervalos de confianza para una media**

Recordemos la f칩rmula para hallar el intervalo de confianza para una media es:

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("ICmedia.png") 
```
-   **Puntuaci칩n Z:** Se ha considerado 1.96 dado que es lo que corresponde al considerar el nivel de confianza de 95% en una distribuci칩n normal.

$$IC = \bar{X} \pm 1.96 \times \frac{s}{\sqrt{n}}$$


### **3.Intervalo de confianza de una media seg칰n grupo**

El an치lisis de medias por grupos mediante intervalos de confianza (IC) es una herramienta fundamental en la inferencia estad칤stica, ya que permite estimar el rango en el que es probable que se encuentre la media poblacional de cada grupo, con un determinado nivel de confianza, como el 95%. Este enfoque es 칰til cuando se quiere comparar subgrupos dentro de una poblaci칩n, ya sea por g칠nero, nivel socioecon칩mico, ubicaci칩n geogr치fica, entre otros.

Un aspecto clave del an치lisis con intervalos de confianza es observar si los intervalos de los grupos se solapan o no:

-  Si los intervalos no se cruzan, se puede inferir que existe una diferencia significativa entre las medias de los grupos.

- Si los intervalos se solapan, no podemos afirmar con certeza que las medias sean significativamente diferentes, lo que sugiere que las diferencias observadas podr칤an deberse al azar.


# **Prueba T**

Generalmente, cuando queremos comparar dos grupos centramos nuestra atenci칩n en el promedio de cada uno. Sin embargo, el hecho de que los promedios sean distintos no supone, necesariamente, que existe una diferencia **estad칤sticamente significativa**.

Para saber si la diferencia observada entre las medias de dos grupos es o no significativa se emplean m칠todos param칠tricos como el de Z-scores o la distribuci칩n T-student. Estas t칠cnicas calculan los intervalos de confianza de cada grupo y concluyen si existe una diferencia _real_ entre las medias.

La prueba T compara la media de una variable num칠rica para dos grupos o categor칤as de una variable nominal u ordinal. Los grupos que forman la variable nominal/ordinal tienen que ser independientes. Es decir, cada observaci칩n debe pertenecer a un grupo o al otro, pero **no** a ambos.

**Ejemplo pr치ctico:**



# **游뚳 Din치micas del uso de los medios de transporte en Lima** 

El crecimiento acelerado de Lima ha generado una creciente preocupaci칩n sobre la calidad y eficiencia de los medios de transporte en la ciudad. La congesti칩n vehicular, la falta de infraestructura adecuada y los largos tiempos de viaje afectan diariamente a millones de lime침os. En este contexto, el an치lisis de datos cuantitativos se vuelve indispensable para entender el comportamiento de los usuarios, identificar 치reas cr칤ticas y dise침ar soluciones efectivas. En ese sentido en esta sesi칩n responderemos a la siguiente pregunta:

<style>
.custom-text {
  color: #00688B;
  font-family: Helvetica, sans-serif;
  text-align: center;
  font-weight: bold;
  font-size: 22px;
}
</style>

::: custom-text
쮺u치l es el estado del transporte en Lima seg칰n sus residentes? 游뱂
:::

Para acercarnos a responder la pregunta antes planteada se busc칩 informaci칩n relacionada al uso del transporte p칰blico en Lima. Por lo tanto se eligi칩 la encuesta de Lima Como Vamos, la cual es realizada a ciudadanos de Lima y Callao con la finalidad de conocer su percepci칩n acerca de la movilidad, ambiente, seguridad ciudadana, espacios de recreaci칩n, cultura y satisfacci칩n con la ciudad. Pueden encontrar m치s informaci칩n acerca de esta base [aqu칤](https://www.limacomovamos.org/data/).

Para esta sesi칩n se usar치 una versi칩n *subseteada* de a침os anteriores que contiene las siguientes variables:

```{r, echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("pd4-diccionario.png") 
```

```{r}
data=import("Limacomovamos-pd4.xlsx") 
```

<hr> 
<hr> 

<h4 style="color: #00688B; text-align: center;"><b>쮺u치l es el intervalo de confianza para la proporci칩n de las personas que est치n satisfechas con el transporte p칰blico en Lima?</b></h4>



Para ello trabajaremos con la variable satis_transporte, que tiene dos valores posibles: Satisfecho y no satisfecho.

Para poder encontrar el intervalo de confianza para la proporci칩n de ciudadanos de Lima y Callao satisfechos con el sistema de transporte, necesitamos tener muy claro la frecuencia de nuestro caso de 칠xito y del total de casos.

```{r}
tablaSatis = data %>%
  filter(satis_transporte =="No satisfecho" | satis_transporte == "Satisfecho") %>%
  count(칄xito = satis_transporte, name="N") %>%
  mutate(total = sum(N), 
         Porcentaje = N / total * 100)
tablaSatis
```

Hallamos el invervalo de confianza para una proporci칩n con el comando **prop.test**

```{r, results='hide'}
prop.test(194,3738) #casos de 칠xito y el total de casos.
```

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("pd4resultprop.png") 
```
Esto quiere decir que tenemos un 95% de certeza de que, en la poblaci칩n, el porcentaje de ciudadanos de Lima y Callao satisfechos con el sistema de transporte oscila entre el 4.5% y 5.9% .
<hr> 
<hr> 

<h4 style="color: #00688B; text-align: center;"><b>쮺u치nto gastan los residentes de Lima en transporte?</b></h4>


*Hallemos el intervalo de confianza para la media de la variable "PE10A".*

El enunciado de la pregunta es indicar "En promedio, 쯖u치nto gasta su hogar en Transporte?".

```{r}
class(data$PE10A) #Revisemos que nuestra variable est칠 bien clasificada
```

**ciMean**, del paquete **lsr**, es la funci칩n que calcula el intervalo de confianza de una media.

```{r}
library(lsr)
ic_media = ciMean(data$PE10A, na.rm = TRUE) #con el 칰ltimo argumento indicamos no tomar en consideracion los valores perdidos (NA)

ic_media
```
<hr> 
<hr> 

<h4 style="color: #00688B; text-align: center;"><b>쮻e qu칠 manera la zona de Lima en la que vive la persona se relaciona con su gasto en transporte?</b></h4>


Hallemos el intervalo de confianza para el gasto en trasporte en promedio (PE10A) seg칰n estrato de lima (ESTRATOS_IOP).

Agreguemos etiquetas a la categ칩rica

```{r,echo=FALSE, out.width="70%",fig.align="center"}
knitr::include_graphics("pd4-estratos.png") 
```

```{r}
data = data %>% 
  mutate(ESTRATOS_IOP=factor(ESTRATOS_IOP, levels = (1:4), labels = c("Lima Centro","Lima Este","Lima Norte", "Lima Sur")))
```

Crearemos una tabla con la media, m치ximo y m칤nimo de la variable PE10A, en base al grupo de ESTRATOS_IOP.

```{r}
ic_grupo = data %>% 
  dplyr::group_by(ESTRATOS_IOP) %>% 
  dplyr::summarise(Media = mean(PE10A, na.rm=T),
            min = ciMean(PE10A, na.rm=T)[1],
            max = ciMean(PE10A, na.rm=T)[2])
ic_grupo
```

Seg칰n nuestra tabla, podemos afirmar que hay un 95% de probabilidad de que a nivel poblacional la media del grupo que los residentes de Lima Centro y Lima Norte gastan m치s en transporte que los de Lima Este.

Grafiquemos nuestros resultados.

```{r}
library(ggplot2)

ggplot(ic_grupo, aes(x = ESTRATOS_IOP, y = Media)) +
  geom_bar(stat = "identity", fill = "#00688B", color = "black") +
  geom_errorbar(aes(ymin = min, ymax = max), width = 0.2) +
  
  # Etiquetas de la media
  geom_text(aes(label = paste(round(Media, 2))), vjust = -1, size = 4) +
  
  # Etiquetas de los valores m칤nimos
  geom_text(aes(y = min, label = paste("min:", round(min, 2))), 
            vjust = 1.5, hjust = -0.2, size = 3, color = "white") +
  
  # Etiquetas de los valores m치ximos
  geom_text(aes(y = max, label = paste("max:", round(max, 2))), 
            vjust = -0.5, hjust = -0.2, size = 3, color = "#00688B") +
  
  xlab("Zona de Lima") + 
  ylab("Promedio del gasto en transporte") +
  ylim(0, 140) +
  theme_minimal()

```

Con lo que muestra el gr치fico, 쯖칩mo podemos complementar nuestra interpretaci칩n anterior?

- Lima Centro gasta significativamente m치s que Lima Este y Lima Sur, como lo indican los promedios y la falta de superposici칩n considerable entre los IC.
- Lima Norte presenta un rango de gasto m치s amplio, lo que sugiere una variabilidad mayor en el gasto de transporte dentro de esa zona.
- Lima Este tiene un gasto m치s bajo y su intervalo de confianza no se superpone con el de Lima Centro, lo que podr칤a indicar diferencias estad칤sticamente significativas entre estas dos zonas.

<h4 style="color: #00688B; text-align: center;"><b>쮼xiste una diferencia estad칤sticamente significativa entre el gasto en transporte entre hombres y mujeres?</b></h4>

Reviso mi df
```{r}
str(data)
```
```{r}
GSexo = data |> 
  group_by(SEXO) |>
  summarize(Media = mean(PE10A, na.rm = T))
GSexo
```
```{r}
GSexo[1,2] - GSexo[2,2]
```
La diferencia es de aprox 11 soles. 쯇uedo afirmar que existe esta diferencia en la poblaci칩n?

Para poder evaluar si existen o no diferencias poblacionales usaremos t.test

```{r}
t.test(PE10A ~ SEXO, data = data)
```
El valor p- value es 0.2642, que es mayor que el nivel t칤pico de significancia (generalmente 풤 = 0.05). Un valor p alto sugiere que *no* hay suficiente evidencia para rechazar la hip칩tesis nula. En otras palabras, no podemos concluir que existe una diferencia significativa entre las medias de los dos grupos (hombres y mujeres) con respecto a la variable PE10A.

# **Ejercicios para casa**

1.  Calcular el intervalo de confianza de la media para los a침os que llevan viviendo en Lima/Callao los residentes de Lima/Callao (EG2OTRO). Interprete
2.  Muestra un gr치fico que los intervalos de confianza para la media de EG2OTRO seg칰n nivel socio econ칩mico (NSE_IOP). Interprete
3.  A partir de la variable EG2OTRO, se cre칩 "A침oslima". Que tiene dos grupos "M치s de 50 a침os" o "De 50 a침os a menos". Calcula el intervalo de confianza para la proporci칩n de la variable "A침oslima" e interpreta.
