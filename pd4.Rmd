---
title: "Práctica dirigida 4"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 1
    theme: cosmo
    highlight: textmate
    always_allow_html: yes
  pdf_document:
    toc: yes
    toc_depth: '1'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estadística para el análisis político 1 \| Semestre 2024 - 1 <br>

# **1.Intervalos de confianza**

Con este tema, comenzaremos a enfocarnos en la estadística inferencial. El objetivo de esta es determinar una aproximación del parámetro poblacional a partir de la data de una muestra representativa.

Revisemos algunos conceptos:

-   **Estimador puntual:** un número que es nuestra predicción del parámetro

-   **Intervalo de confianza:** un intervalo de números basado en la distribución de la data observada de la muestra dentro de la cual se cree que estaría el parámetro poblacional.

    *IC = estimador puntual +-/margen de error*

-   **Nivel de confianza:** es la probabilidad de que el parámetro se encuentre en ese intervalo.

-   **Margen de error:** mide qué tan precisa es la estimación del parámetro.

-   **Error de muestreo:** diferencia entre el valor calculado de un estadístico y valor real de un parámetro de la población.

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("IC.png") 
```

### Conceptualización e Importancia

-   Los intervalos de confianza ofrecen una manera de estimar, con alta probabilidad, un rango de valores en el que se encuentra el valor poblacional (o parámetro) de una determinada variable.
-   El intervalo de confianza describe la variabilidad entre la medida obtenida en un estudio y la medida real de la población (el valor real).
-   Un intervalo de confianza de 90%/95%/99% nos indica que dentro del rango dado se encuentra el valor real de un parámetro con 90%/95%/99% de certeza.
-   Existe una relación inversa entre la amplitud del IC y el tamaño muestral: mientras más pequeño es el n, más amplio es el IC. A mayor n, el IC es más estrecho.
-   Gracias al IC podemos determinar si la estimación es representativa de la población.

### Sobre el nivel de confianza...

Si tenemos un nivel de confianza de 95%, quiere decir que si realizamos 100 veces el mismo procedimiento de muestreo y calculamos los estadísticos de interés, 95 veces obtendremos los resultados en el intervalo calculado. Los mismo ocurriría si realizamos el cálculo con un 99% de confianza. Al momento de decidir el nivel de confianza debemos tener presente una regla: a mayor nivel de confianza, menor será la precisión ya que el intervalo es más amplio.

En esta sesión responderemos a la pregunta:

## ¿Cuál es el estado del transporte en Lima según sus residentes?

# **1.Intervalos de confianza para una proporción**

Tengamos en consideración que para poder hallar el intervalo de confianza para una proporción debemos determinar nuestro caso de éxito. Asimismo, para hallar el intervalo de confianza para una proporción nuestra variable debe ser categórica y debe representar una variable dicotómica; es decir, una variable con solo dos categorías posibles: votó/no votó; sí/no, etc.

Recordemos la fórmula para hallar el intervalo de confianza para una proporción

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("ICprop.png") 
```

*Hallemos el intervalo de confianza para la proporción de las personas que están satisfechas con el transporte público en Lima.*

Para ello trabajaremos con la variable satis_transporte expolicacion de donde sale satis_transporte (EG6B)

Para poder encontrar el intervalo de confianza para la proporción de personas que opinan que hay mucha desigualdad en Perú, necesitamos tener muy claro la frecuencia de nuestro caso de éxito y del total de casos.

```{r}
x = 868 #almacenamos en "x" la frecuencia de nuestro caso de éxito
n = 868 + 625 #almacenamos en "n" el total de casos
```

Hallamos el invervalo de confianza para una proporción con el comando **prop.test**

```{r}
ic_prop = prop.test(x,n)
ic_prop #llamamos a ic_prop para visualizar los resultados
```

CORREGIR Esto quiere decir que tenemos un 95% de certeza de que, en la población, el porcentaje de personas que considera que existe mucha desigualdad en el Perú oscila entre el 55.6% y 60.6% .

# **2.Intervalos de confianza para una media**

Carguemos la data *Limacomovamos.xlsx*

Lima Cómo Vamos es un observatorio ciudadano que realiza seguimiento y evaluación a los cambios producidos en la calidad de vida de los habitantes de Lima Metropolitana.

```{r}
library(dplyr)
library(rio) #Convocamos el paquete   
data=import("Limacomovamos-pd4.xlsx") 
names(data)
```

```{r,echo=FALSE, out.width="80%"}
knitr::include_graphics("DiccionarioLCV.png") 
```

Recordemos la fórmula para hallar el intervalo de confianza para una media es

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("ICmedia.png") 
```

### ¿Cuánto gastan los residentes de lima en transporte?

*Hallemos el intervalo de confianza para la media de la variable "PE10A".*

```{r}
class(data$PE10A) #Revisemos que nuestra variable esté bien clasificada
```

**ciMean**, del paquete **lsr**, es la función que calcula el intervalo de confianza de una media.

```{r}
library(lsr)
ic_media = ciMean(data$PE10A, na.rm = TRUE) #con el último argumento indicamos no tomar en consideracion los valores perdidos (NA)

ic_media
```

CORREGIR Nuestra media poblacional se encuentra entre 7.54 y 7.83. Esto quiere decir que la estimación del intervalo indica que tenemos un 95% de certeza de que el valor poblacional del nivel de acuerdo con la afirmación "El Estado peruano debe implementar políticas firmes para reducir la desigualdad de ingresos entre ricos y pobres" se encuentra entre 7.5 y 7.8.

# **3.Intervalo de confianza de una media según grupo**

Hallemos el intervalo de confianza para el gasto en trasporte en promedio (PE10A) según estrato de lima (ESTRATOS_IOP).

### 1. Crearemos una tabla con la media, máximo y mínimo de la variable PE10A, en base al grupo de ESTRATOS_IOP.

```{r}
ic_grupo = data %>% 
  dplyr::group_by(ESTRATOS_IOP) %>% 
  dplyr::summarise(Media = mean(PE10A, na.rm=T),
            min = ciMean(PE10A, na.rm=T)[1],
            max = ciMean(PE10A, na.rm=T)[2]
            )
ic_grupo
```

### 2. Grafiquemos los resultados 

```{r}
library(ggplot2)
ggplot(ic_grupo, aes(x= ESTRATOS_IOP, y =Media)) +
  geom_errorbar(aes(ymin=min, ymax=max), width = 0.2)+
   geom_text(aes(label=paste(round(Media, 2))), size=4)+
  xlab("Estratificación IOP") + ylab("Promedio del gasto en transporte")+
  ylim(130, 40)
```

¿Qué podemos extraer del gráfico?

## Ejercicio

ARREGLAR PREGUNTAS - Trabajemos con la variable p03_1: nivel de acuerdo con la frase "En el Perú todos tienen iguales oportunidades para salir de la pobreza", va del 1 (muy en desacuerdo) al 10 (muy de acuerdo)

-   ¿Cuál es el intervalo de confianza de la media de la variable?

-   ¿ Cuál es la diferencia del intervalo de confianza de la media según región natural? (variable region)
