---
title: "Pr√°ctica dirigida 2"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 4
    theme: cosmo
    highlight: textmate
    always_allow_html: yes
    output: pdf_document
  pdf_document:
    toc: yes
    toc_depth: '4'
editor_options:
  markdown:
    wrap: 72
---

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estad√≠stica para el an√°lisis pol√≠tico 1 \| Semestre 2024 - 2 <br>

------------------------------------------------------------------------

# **1.¬øQu√© es el an√°lisis descriptivo?**

```{r,echo=FALSE, out.width="80%",fig.align="center"}
knitr::include_graphics("pd2_QSAnalisisDesc.png") 
```

# **2.Nivel de medida de una variable**

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("pd2_medVar.png") 
```

# **3.Importancia de visualizaci√≥n de datos**

Debido al crecimiento de la big data en los √∫ltimos a√±os surgieron
nuevas necesidades para comprender los an√°lisis masivos de datos de una
forma simple y escalable. Es entonces cuando se dirige la atenci√≥n a
desarrollar nuevas t√©cnicas gr√°ficas en distintas plataformas (ejemplos
a continuaci√≥n), tanto softwares como librer√≠as de c√≥digo abierto[^1],
tal es el caso de ggplot2 en R.

[^1]: <https://www.data-to-viz.com/caveat/pie.html>

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_herramientas.png") 
```

Este inter√©s por desarrollar t√©cnicas de an√°lisis masivo de datos y la
comunicaci√≥n de resultados cada vez m√°s amigables y apta para todos los
p√∫blicos dio pie a nuevas especialidades dentro de la ciencia de datos,
como por ejemplo el data story telling

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_datavis.png") 
```

### **Gr√°ficos por tipo de variables:**

```{r,echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("pd2_GrafTipoVar.png") 
```

# **4.An√°lisis descriptivo**

```{=html}
<style>
.custom-text {
  color: #00688B;
  font-family: Helvetica, sans-serif;
  text-align: center;
  font-weight: bold;
  font-size: 22px;
}
</style>
```
::: custom-text
¬øCu√°l es la percepci√≥n de desigualdad en el Per√∫ el 2024? ü§î
:::

Para dar respuesta a la pregunta de investigaci√≥n que guiara la pr√°ctica
dirigida analizaremos algunas de las variables que forman parte de la
Encuesta Nacional de Percepci√≥n de Desigualdades - ENADES 2024, que fue
elaborada por Instituto de Estudios Peruanos (IEP) y Oxfam. La encuesta
busca ahondar en la percepci√≥n de las diferentes formas de desigualdad
en el Per√∫ e incorpora indicadores que permiten medir la magnitud de
brechas sociales y pol√≠ticas como g√©nero, clase, entre otros.

Se eligieron algunas variables de la base de datos original y se dejaron
por fuera valores perdidos adem√°s de realizar otras modificaciones. Para
realizar alguna investigaci√≥n se debe usar la base de datos original que
se encuentra en el siguiente [link](https://peru.oxfam.org/ENADES-2024).

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("diccionario_enades2024.png") 
```

```{r,warning=FALSE}
library(rio) #Convocamos el paquete   
data=import("pd2_enades2024.xlsx")
```

```{r}
str(data) #revisamos las variables
```

## 4.1 ¬øCu√°l es la percepci√≥n de la desigualdad en calidad de vida en el Per√∫?

### **Indicador Proxy**

TambieÃÅn llamado indicador indirecto, se usa ante la imposibilidad de
medir lo que efectivamente es de importancia. El indicador mide una
variable distinta a la que nos interesa de manera especiÃÅfica, pero
presenta una relacioÃÅn lo maÃÅs directa posible con el fenoÃÅmeno en estudio.

Un indicador proxy es una medici√≥n o se√±al indirecto que aproxima o
representa un fen√≥meno en la ausencia de una medici√≥n o se√±al directo.

### **Indicador Aditivo**

Es una variable latente que se genera a trav√©s de la suma de un conjunto
de variables manifiestas u observables. Luego de la suma se procede a
aplicar una formula que genera que el valor m√°ximo de la variable sea 1
y el m√≠nimo sea 0. A partir de eso se puede multiplicar por cualquier
n√∫mero para que el m√°ximo cambie. Es as√≠ que si se multiplica por 10, el
indicador ir√° de 0 a 10; si se desea que el indicador sea de 0 a 50, se
debe multiplicar por 50; etc.

```{r,echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("pd2_ejemplo.png") 
```

Sin embargo, el paquete scales nos facilita el uso del comando
**rescale.** Al usarlo solo necesitamos se√±alar los l√≠mites del
indicador.

#### Pasos para construir un indicador:

1.  Verificar que las variables que construyan el indicador correspondan
    al concepto que se desea medir. *Ejemplo: Si deseo mejor
    Satisfacci√≥n del Usuario, las preguntas deben ser sobre ello.*
2.  Revisar el cuestionario e identificar el sentido de las categor√≠as.
    *Ejemplo: El valor 5 es "Muy instafisfecho" y 1 "Muy satisfecho"*
3.  Si las categor√≠as de las variables est√°n en el correcto sentido
    proceder a sumarlas, si no lo est√°n, proceder a recodificarlas para
    luego sumar.
4.  Una vez realizada la suma, identificar el m√≠nimo y el m√°ximo.
5.  Aplicar la funci√≥n **rescale** (paquete scales) con el rango
    espec√≠fico.

Construiremos un indicador aditivos de percepci√≥n de desigualdad en
calidad de vida en el Per√∫, que vaya del 0 al 100. Para ello usaremos a
las variables `d_educ`, `d_salud`, `d_trabajo` y `d_justicia`.

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("tablitaenades2024.png") 
```

El indicador que queremos crear es de percepci√≥n de desigualdad, por
tanto mayor valor deber√≠a significar mayor desigualdad. En este caso, un
mayor valor quiere decir menos desigualdad. Debemos cambiarlo.

```{r, warning=FALSE,message=FALSE}
library(dplyr)
data <- data %>%
  mutate(d_educ = case_when( d_educ == 1 ~ 4,
                            d_educ == 2 ~ 3,
                            d_educ == 3 ~ 2,
                            d_educ == 4 ~ 1),
      d_salud = case_when(d_salud == 1 ~ 4,
                          d_salud == 2 ~ 3,
                          d_salud == 3 ~ 2,
                          d_salud == 4 ~ 1),
      d_trabajo = case_when(d_trabajo == 1 ~ 4,
                            d_trabajo == 2 ~ 3,
                            d_trabajo == 3 ~ 2,
                            d_trabajo == 4 ~ 1),
      d_justicia = case_when(d_justicia == 1 ~ 4,
                             d_justicia == 2 ~ 3,
                             d_justicia == 3 ~ 2,
                             d_justicia == 4 ~ 1))
```

Tambi√©n podemos usar esta opci√≥n m√°s corta. En esta le estamos pidiendo
ejecutar un cambio sa trav√©s de las cuatro variables mencionadas, y
luego mencionamos la condici√≥n. Para no repetir las cuatro variables en
cada condici√≥n podemos poner un punto (.).

```{r opci√≥n corta, eval=T}
data <- data %>%
  mutate(across(c(d_educ, d_salud, d_trabajo, d_justicia),
    ~ case_when(
        . == 1 ~ 4,
        . == 2 ~ 3,
        . == 3 ~ 2,
        . == 4 ~ 1)))
```

üó®Ô∏è Para poder crear el indicador, necesitamos que todas las variables a
usar sean num√©ricas porque las tendremos que sumar. Entonces, primero
verificamos el tipo de dato de cada variable.

```{r}
str(data)
```

```{r}
data=data %>%
  mutate(suma = d_educ + d_salud + d_trabajo + d_justicia)
```

Revisamos m√≠nimo y m√°ximo

```{r}
summary(data$suma)
```

Creamos el indicador de 0 al 100

```{r,warning=FALSE}
library(scales)
data = data %>%
  mutate(indicador = rescale(suma, to = c(0, 100)))
```

Analicemos los descriptivos del indicador que creamos

```{r}
data %>% 
  group_by(clase) %>% 
  summarise(
    Media = mean(indicador), 
    Mediana = median(indicador), 
    Desviacion = sd(indicador), 
    Minimo = min(indicador), 
    Maximo = max(indicador),
    Q1 = quantile(indicador, 0.25), #Primer cuartil
    Q3 = quantile(indicador, 0.75) #Tercer cuartil
  )
```

## 4.2 ¬øCu√°l es la diferencia de la percepci√≥n de desigualdad entre *clases*?

Primero indiquemos las etiquetas de la variable. El diccionario de datos
indicaba que hab√≠a 4 niveles para la variable clase. Dentro del mutate,
debemos iniciar indicando que queremos que la variable sea factor, los
niveles van del 1 al 4 y luego indicamos la etiqueta para cada nivel. La
etiqueta se otorga en el orden. En este caso el 1 ser√° Alta, 2 ser√°
Media alta, 3 ser√° Media baja y 4 ser√° Baja.

```{r}
data = data %>%
 mutate(clase = factor(clase, levels = 1:4, labels = c("Alta", "Media alta", "Media baja", "Baja"), ordered = TRUE))

```

Para hacer la tabla resumen de los descriptivos debemos agregar la
agrupaci√≥n por clase antes. As√≠ los resultados saldr√°n seg√∫n la clase.

```{r}
data%>%
  group_by(clase) %>%
  summarise(
    Media = mean(indicador), 
    Mediana = median(indicador), 
    Desviacion = sd(indicador), 
    Minimo = min(indicador), 
    Maximo = max(indicador),
    Q1 = quantile(indicador, 0.25), #Primer cuartil
    Q3 = quantile(indicador, 0.75) #Tercer cuartil
  )
```

```{r}
library(ggplot2)
ggplot(data, aes(x=clase, y=indicador, color=clase)) + 
  geom_boxplot() + 
  geom_jitter(shape=16, position=position_jitter(0.2),alpha=0.6) +#para agregar los casos como puntos
  theme_classic()
```

‚û°Ô∏è An√°lisis: En el segundo gr√°fico la dispersi√≥n de los datos es muy
similar en el grupo de clase social Media baja y Baja. Por otro lado, en
el grupo de la clase Alta, se aprecia que la dispersi√≥n es mucho mayor
(la caja es mucho m√°s grande). Los *outliers* se muestran como puntos
individuales m√°s all√° del bigote de la caja, los puntos m√°s alejados se
encuentran en el grupo de clase Baja.

# 

## 4.2 ¬øC√≥mo se distribuye (%)la percepci√≥n de desigualdad econ√≥mica en el Per√∫?

Usaremos la variable **P07**:

`¬øQu√© tan desigual cree que es el Per√∫ econ√≥micamente?`

De acuerdo al diccionario de datos encontramos cuatro posibles
respuestas

-   1:Nada
-   2:Poco
-   3:Algo
-   4:Mucho

### **An√°lisis de una variable ordinal**

Pasos para analizar una variable ordinal A. Identificar el tipo de
variable (str, class) B. Convertimos la variable al tipo de dato que
necesitamos dependiendo el caso C. Elaboramos un objeto que nos permita
ver preliminarmente los datos de la variable. D. Elaboramos un gr√°fico
que vaya acorde a la variable ordinal (gr√°fico de barras)

Comprobamos el tipo de dato que analizaremos

```{r}
class(data$P07)
```

Del diccionario de datos, sabemos que esta variable es **ordinal**,
revisemos si los niveles tienen coherencia con las respuestas recogidas
en la encuesta.

```{r}
data %>%
 group_by(P07) %>%
 summarise(Freq=n()) #Veamos los niveles de la variable
```

üí• Etiquetamos y categorizamos como factor. Para ello usaremos el
comando **mutate**. Este comando forma parte del paquete dplyr. Lo
usaremos cada vez que se quiera modificar de alguna forma la data o
alguna variable en espec√≠fico.

```{r}
data = data %>%
 mutate(P07 = factor(P07, levels = 1:4, labels = c("Nada", "Poco", "Algo", "Mucho"), ordered = TRUE))
```

En este caso queremos que dentro de la variable P07 se almacene el
resultado de convertir P07 a factor y seg√∫n los cuatro niveles que tiene
otorgar una etiqueta. Es as√≠ que lo que aparece como 1 ser√° Nada, lo que
aparece como 2 ser√° Poco, 3 ser√° Algo y 4, Mucho.

Revisemos que el cambio se haya realizado correctamente usando el
comando **summarise** del paquete `dplyr`. Los resultados de la tabla
deben mantenerse, lo que var√≠a debe ser la etiqueta de la categor√≠a.

```{r}
data %>%
 group_by(P07) %>%
 summarise(Freq=n())
```

A primera vista, la tabla nos indica que la mayor√≠a de los encuestados
(453) opina que hay mucha desigualdad econ√≥mica en el pa√≠s. Pero,
¬øcu√°nto ser√≠a dicho resultado en porcentaje?

Podemos realizar una tabla de frecuencias y porcentajes agregando una
linea al comando anterior. Asimismo, para poder graficar los resultados
de las tablas, tendremos que almacenarlas en un objeto. Trabajemos con
esta tabla resumen y asignemosle el nombre *`para_grafico`* para
posteriormente llamarla al graficar.

Para agregar el porcentaje usaremos **mutate**. Recordemos que el
porcentaje ser√≠a el resultado de la frecuencia de la categor√≠a sobre el
total. Debemos solicitarle a R que realice ese c√°lculo en cada fila.

```{r}
para_grafico=data %>%
 group_by(P07) %>%
 summarize(Freq=n()) %>%
 mutate(Porcentaje = (Freq / sum(Freq))*100)
```

Hemos creado un nuevo objeto llamado para_grafico. Para poder
visualizarlo podemos llamarlo por su nombre. Siempre que almacenemos un
objeto, debemos llamarlo para poder visualizarlo.

```{r}
para_grafico
```

Afirmamos que m√°s del 50% de los encuestados percibe que el pa√≠s es muy
desigual econ√≥micamente.

Tambi√©n podemos analizar c√≥mo cambia esto si solo seleccionamos los
casos de los encuestados/as menores de 30 a√±os. Para ello haremos uso
del comando **filter**. Este comando necesita dos argumentos: a. La
variable sobre la cual se filtrar√° y b. la condici√≥n. En este caso la
variable es edad y la condici√≥n es "menos a 30" o \<30.

```{r}
data %>%
  filter(edad<30)%>%
  group_by(P07) %>%
  summarize(Freq=n()) %>%
  mutate(Porcentaje = (Freq / sum(Freq))*100)
```

Grafiquemos los resultados con *`ggplot2`*

Nuestra variable es categ√≥rica, por lo tanto realizaremos el gr√°fico
acorde:

```{r}
ggplot(para_grafico, aes(x=P07, y=Porcentaje, fill=P07)) + 
geom_bar(stat = "identity") +
  theme_bw()
```

Este es un gr√°fico b√°sico, pero podemos personalizarlo[^2] seg√∫n
nuestros gustos.

[^2]: <https://cran.r-project.org/web/packages/tayloRswift/readme/README.html>

```{r}
library(tayloRswift) #opcional (una ventaja de que R sea software libre)

ggplot(para_grafico, aes(x=P07, y=Porcentaje, fill=P07)) + 
  geom_bar(stat = "identity")  +
  ggtitle("Percepci√≥n de desigualdad econ√≥mica") +
  xlab("¬øQu√© tan desigual cree que es el Per√∫ econ√≥micamente") + ylab("Porcentaje")+
  geom_text(aes(label=round(Porcentaje,1)), vjust=1.30, color="black", size=3)+
  theme(panel.background=element_rect(fill = "white", colour = "white")) +
  scale_fill_taylor(palette = "lover") #fearless, speakNow, Red

```

El ejercicio de an√°lisis descriptivo con variables num√©ricas lo
realizaremos con un indicador aditivo que crearemos a continuaci√≥n.

# **5. Ejercicios**

1.  Analiza los descriptivos de la variable P08. Recuerda determinar
    primero qu√© tipo de variable es. Realiza el gr√°fico correspondiente
    e interpreta.

2.  Analiza los descriptivos de la variable P37. Recuerda determinar
    primero qu√© tipo de variable es. Realiza el gr√°fico correspondiente
    e interpreta.

3.  Crea el indicador de percepci√≥n de gravedad de desigualdad
    socioecon√≥mica en el Per√∫. Para ello usa las variables P17, P18,
    P19, P20, P21 y P22. El indicador debe ir del del 0 al 10, en donde
    0 sea nada grave y 10 sea muy grave. No olvides revisar el sentido
    de cada pregunta.

4.  Con el indicador creado previamente, realiza el gr√°fico pertinente e
    interpreta.
