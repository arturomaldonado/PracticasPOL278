---
title: "Pr√°ctica dirigida 2"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 4
    theme: cosmo
    highlight: textmate
    always_allow_html: true
    output: pdf_document
---

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estad√≠stica para el an√°lisis pol√≠tico 1 \| Semestre 2024 - 1 <br>

------------------------------------------------------------------------

# **1.¬øQu√© es el an√°lisis descriptivo?**

```{r,echo=FALSE, out.width="80%",fig.align="center"}
knitr::include_graphics("pd2_QSAnalisisDesc.png") 
```

# **2.Nivel de medida de una variable**

```{r,echo=FALSE, out.width="50%",fig.align="center"}
knitr::include_graphics("pd2_medVar.png") 
```

# **3.Importancia de visualizaci√≥n de datos**

Debido al crecimiento de la big data en los √∫ltimos a√±os surgieron nuevas necesidades para comprender los an√°lisis masivos de datos de una forma simple y escalable. Es entonces cuando se dirige la atenci√≥n a desarrollar nuevas t√©cnicas gr√°ficas en distintas plataformas (ejemplos a continuaci√≥n), tanto softwares como librer√≠as de c√≥digo abierto[^1], tal es el caso de ggplot2 en R.

[^1]: <https://www.data-to-viz.com/caveat/pie.html>

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_herramientas.png") 
```

Este inter√©s por desarrollar t√©cnicas de an√°lisis masivo de datos y la comunicaci√≥n de resultados cada vez m√°s amigables y apta para todos los p√∫blicos dio pie a nuevas especialidades dentro de la ciencia de datos, como por ejemplo el data story telling

```{r,echo=FALSE, out.width="90%",fig.align="center"}
knitr::include_graphics("pd2_datavis.png") 
```

### **Gr√°ficos por tipo de variables:**

```{r,echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("pd2_GrafTipoVar.png") 
```

# **4.An√°lisis descriptivo**

```{=html}
<style>
.custom-text {
  color: #00688B;
  font-family: Helvetica, sans-serif;
  text-align: center;
  font-weight: bold;
  font-size: 22px;
}
</style>
```
::: custom-text
¬øCu√°l es la percepci√≥n de desigualdad en el Per√∫ el 2022? ü§î
:::

Para dar respuesta a la pregunta de investigaci√≥n que guiara la pr√°ctica dirigida analizaremos algunas de las variables que forman parte de la Encuesta Nacional de Percepci√≥n de Desigualdades - ENADES 2022, que fue elaborada por Instituto de Estudios Peruanos (IEP) y Oxfam. La encuesta busca ahondar en la percepci√≥n de las diferentes formas de desigualdad en el Per√∫ e incorpora indicadores que permiten medir la magnitud de brechas sociales y pol√≠ticas como g√©nero, clase, entre otros.

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("Diccionario-enades.png") 
```

```{r,warning=FALSE}
library(rio) #Convocamos el paquete   
data=import("Enades_2022_final.xlsx") 

str(data)
```

```{r}
names(data) #revisamos las variables
```

## 4.1 ¬øC√≥mo se distribuye (%)la percepci√≥n de desigualdad econ√≥mica en el Per√∫?

Usaremos la variable **P04**:

`¬øQu√© tan desigual cree que es el Per√∫ econ√≥micamente?`

De acuerdo al diccionario de datos encontramos cuatro posibles respuestas

-   1:Mucho

-   2:Algo

-   3:Poco

-   4:Nada

### **An√°lisis de una variable ordinal**

Pasos para analizar una variable ordinal A. Identificar el tipo de variable (str, class) B. Convertimos la variable al tipo de dato que necesitamos dependiendo el caso C. Elaboramos un objeto que nos permita ver preliminarmente los datos de la variable. D. Elaboramos un gr√°fico que vaya acorde a la variable ordinal (gr√°fico de barras)

```{r,warning=FALSE, message=FALSE}
library(dplyr) #Convocamos el paquete
```

```{r}
#comprobamos el tipo de dato que analizaremos
class(data$p04)
```

Del diccionario de datos, sabemos que esta variable es **ordinal**, revisemos si los niveles tienen coherencia con las respuestas recogidas en la encuesta.

```{r}
data %>%
 group_by(p04) %>%
 summarise(Freq=n()) #Veamos los niveles de la variable
```

üí• Otorguemosle etiquetas y categoricemosla como factor:

```{r}
data = data %>%
 mutate(p04 = factor(p04, levels = 1:4, labels = c("Mucho", "Algo", "Poco", "Nada"), ordered = TRUE))
```

Revisemos que el cambio se haya realizado correctamente usando el comando summarise del paquete `dplyr`

```{r}
data %>%
 group_by(p04) %>%
 summarise(Freq=n())
```

A primera vista, la tabla nos indica que la mayor√≠a de los encuestados (794) opina que hay mucha desigualdad econ√≥mica en el pa√≠s. Pero, ¬øcu√°nto ser√≠a dicho resultado en porcentaje?

Podemos realizar una tabla de frecuencias y porcentajes agregando una linea al comando anterior. Asimismo, para poder graficar los resultados de las tablas, tendremos que almacenarlas en un objeto. Trabajemos con esta tabla resumen y asignemosle el nombre *`para_grafico`* para posteriormente llamarla al graficar.

```{r}
para_grafico=data %>%
 group_by(p04) %>%
 summarize(Freq=n()) %>%
 mutate(Porcentaje = (Freq / sum(Freq))*100)

para_grafico
```

Afirmamos que m√°s del 50% de los encuestados percibe que el pa√≠s es muy desigual econ√≥micamente.

Tambi√©n podemos analizar c√≥mo cambia esto si solo seleccionamos los casos de los encuestados/as menores de 30 a√±os.

```{r}
data %>%
  filter(edad<30)%>%
  group_by(p04) %>%
  summarize(Freq=n()) %>%
  mutate(Porcentaje = (Freq / sum(Freq))*100)
```

Grafiquemos los resultados con *`ggplot2`*

Nuestra variable es categ√≥rica, por lo tanto realizaremos el gr√°fico acorde:

```{r}
library(ggplot2)

ggplot(para_grafico, aes(x=p04, y=Porcentaje, fill=p04)) + 
geom_bar(stat = "identity") 
```

Este es un gr√°fico b√°sico, pero podemos personalizarlo[^2] seg√∫n nuestros gustos.

[^2]: <https://cran.r-project.org/web/packages/tayloRswift/readme/README.html>

```{r}
library(tayloRswift) #opcional (una ventaja de que R sea software libre)

ggplot(para_grafico, aes(x=p04, y=Porcentaje, fill=p04)) + 
  geom_bar(stat = "identity")  +
  ggtitle("Percepci√≥n de desigualdad econ√≥mica") +
  xlab("¬øQu√© tan desigual cree que es el Per√∫ econ√≥micamente") + ylab("Porcentaje")+
  geom_text(aes(label=round(Porcentaje,1)), vjust=1.30, color="black", size=3)+
  theme(panel.background=element_rect(fill = "white", colour = "white")) +
  scale_fill_taylor(palette = "Red") #fearless, speakNow, Red

```

El ejercicio de an√°lisis descriptivo con variables num√©ricas lo realizaremos con un indicador aditivo que crearemos a continuaci√≥n.

## 4.2 ¬øCu√°l es la percepci√≥n de la desigualdad en calidad de vida en el Per√∫?

### **Indicador Proxy**

TambieÃÅn llamado indicador indirecto, se usa ante la imposibilidad de medir lo que efectivamente es de importancia. El indicador mide una variable distinta a la que nos interesa de manera especiÃÅfica, pero presenta una relacioÃÅn lo maÃÅs directa posible con el fenoÃÅmeno en estudio.

Un indicador proxy es una medici√≥n o se√±al indirecto que aproxima o representa un fen√≥meno en la ausencia de una medici√≥n o se√±al directo.

### **Indicador Aditivo**

#### Pasos para construir un indicador:

1.  Verificar que las variables que construyan el indicador correspondan al concepto que se desea medir. *Ejemplo: Si deseo mejor Satisfacci√≥n del Usuario, las preguntas deben ser sobre ello.*
2.  Revisar el cuestionario e identificar el sentido de las categor√≠as. *Ejemplo: El valor 5 es "Muy instafisfecho" y 1 "Muy satisfecho"*
3.  Si las categor√≠as de las variables est√°n en el correcto sentido proceder a sumarlas, si no lo est√°n, proceder a recodificarlas para luego sumar.
4.  Una vez realizada la suma, identificar el m√≠nimo y el m√°ximo.
5.  Aplicar la funci√≥n rescale con el rango espec√≠fico.

Construiremos un indicador aditivos de percepci√≥n de desigualdad en calidad de vida en el Per√∫, que vaya del 0 al 100. Para ello usaremos a las variables `d_educ`, `d_salud`, `d_trabajo` y `d_justicia`.

```{r,echo=FALSE, out.width="100%",fig.align="center"}

knitr::include_graphics("pd2_tablita.png") 
```

El indicador que queremos crear es de percepci√≥n de desigualdad, por tanto mayor valor deber√≠a significar mayor desigualdad.

üó®Ô∏è Para poder crear el indicador, necesitamos que todas las variables a usar sean num√©ricas porque las tendremos que sumar. Entonces, primero verificamos el tipo de dato de cada variable.

```{r}
str(data)
```

```{r}
data=data %>%
  mutate(suma = d_educ + d_salud + d_trabajo + d_justicia)

```

Revisamos m√≠nimo y m√°ximo

```{r}
summary(data$suma)
```

Creamos el indicador de 0 al 100

```{r}
library(scales)
data = data %>%
  mutate(indicador = rescale(suma, to = c(0, 100)))


```

```{r}
summary(data$indicador)

```

## 4.3 ¬øCu√°l es la diferencia de la percepci√≥n de desigualdad entre mujeres y hombres?

Ahora, veamos algunas medidas de tendencia central, distribuci√≥n y dispersi√≥n para el caso de variables num√©ricas. Trabajaremos con el indicador que acabamos de crear: `indicador`

Exploremos la variable. Veamos medidas de tendencia central y de dispersi√≥n. Recordemos que va del 0 al 100.

```{r}
data%>%
  summarise(Media = mean(indicador), 
            Mediana = median(indicador),
            Desviacion = sd(indicador),
            Minimo = min(indicador),
            Maximo = max(indicador))
```

Podemos analizar la respuesta seg√∫n el sexo de los encuestados

```{r}
data = data %>%
 mutate(sexo = factor(sexo, levels = 1:2, labels = c("Hombre","Mujer")))

```

```{r}
data %>%
 group_by(sexo) %>%
  summarise(Media=mean(indicador)) 
```

La tabla nos indica que las encuestadas mujeres perciben ligeramente una mayor desigualdad en los derechos y servicios, a comparaci√≥n de los hombres.

Podemos visualizarlo mejor con un gr√°fico

```{r}
ggplot(data, aes(x=sexo, y=indicador, color=sexo)) + 
  geom_boxplot() + 
  geom_jitter(shape=16, position=position_jitter(0.2),alpha=0.4) +#para agregar los casos como puntos
  theme_classic()

```

‚û°Ô∏è An√°lisis: Como podemos ver en el gr√°fico la disperci√≥n de los datos es muy similar en el grupo de hombre y mujeres. Los valores at√≠picos (*outliers*) se muestran como puntos individuales fuera de la caja. La l√≠nea que vemos dentro de la caja nos se√±ala la *mediana*, al comparar las dos l√≠neas se aprecia que la mediana es similar.

En resumen, el `boxplot` es herramienta gr√°fica que proporciona un resumen visual de la distribuci√≥n de un conjunto de datos, mostrando la mediana, los cuartiles, los valores at√≠picos y la variabilidad de los datos.

```{r}
data %>%
 group_by(clase) %>%
 summarise(Freq=n())
```

## 4.4 ¬øCu√°l es la diferencia de la percepci√≥n de desigualdad entre *clases*?

```{r}
data = data %>%
 mutate(clase = factor(clase, levels = 1:4, labels = c("Alta", "Media alta", "Media baja", "Baja"), ordered = TRUE))

```

```{r}
data%>%
  group_by(clase) %>%
  summarise(Media = mean(indicador), 
            Mediana = median(indicador),
            Desviacion = sd(indicador),
            Minimo = min(indicador),
            Maximo = max(indicador))
```

```{r}
ggplot(data, aes(x=clase, y=indicador, color=clase)) + 
  geom_boxplot() + 
  geom_jitter(shape=16, position=position_jitter(0.2),alpha=0.6) +#para agregar los casos como puntos
  scale_color_taylor(palette ="fearless") +
  theme_classic()
```

‚û°Ô∏è An√°lisis: En el segundo gr√°fico la dispersi√≥n de los datos es muy similar en el grupo de clase social Media baja y Baja. Por otro lado, en el grupo de la clase Alta, se aprecia que la dispersi√≥n es mucho mayor (la caja es mucho m√°s grande). Los *outliers* se muestran como puntos individuales m√°s all√° del bigote de la caja, los puntos m√°s alejados se encuentran en el grupo de clase Baja.

***Ejercicio en clase:*** Brinde tres observaciones m√°s sobre el gr√°fico anterior.

**Ejercicio para casa:** Analice descriptivos y elabore el gr√°fico correspondiente para la variable p03_1
