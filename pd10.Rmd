---
title: "Pr치ctica dirigida 10"
output:
  pdf_document:
    toc: yes
    toc_depth: '1'
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 1
    theme: cosmo
    highlight: textmate
    always_allow_html: yes
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

# **Regresi칩n linea m칰ltiple**

Hasta el momento, nos hemos encontrado en el campo del an치lisis bivariado. Sin embargo, en el mundo social, dif칤cilmente se pueden explicar los fen칩menos de inter칠s con una sola variable. Incluso si nos interesa evaluar el efecto de un a variable en espec칤fico sobre un fen칩meno de estudio, hay muchos otros factores que podr칤an influir en aquello que nos interesa explorar. Por ello, necesitamos recurrir al **an치lisis multivariado** y conocer el concepto de **control estad칤stico**. 

El control estad칤stico nos permite aislar el efecto de otras variables. La idea es:

* Evaluar si la asociaci칩n entre X e Y permanece si se remueve el efecto de otra variable, es decir, si se controla por una tercera variable.

* Se analiza la relaci칩n entre X e Y para valores similares o iguales de una variable Z. De esta manera se elimina la influencia de Z en la relaci칩n entre X e Y. Lo anterior nos ayuda a acercarnos a una interpretaci칩n causar X -> Y.

* Si la relaci칩n entre X e Y desaparece cuando se controla por Z, se dice que la relaci칩n era esp칰rea. En otras palabras, la relaci칩n dependendia de la influencia de Z y no de una conexi칩n directa entre X e Y.  

Sobre la regresi칩n lineal m칰ltiple: 

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("pd12_diap1.png") 
```

------------------------------------------------------------------------

Seguiremos los siguientes pasos para el an치lisis: 

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("pd12_diap2.png") 
```

# Aplicaci칩n pr치ctica

## **Factores que determinan el acceso a la informaci칩n en los Estados**

El acceso a la informaci칩n es fundamental para el funcionamiento de cualquier Estado democr치tico, ya que promueve la transparencia, la responsabilidad y la participaci칩n ciudadana. 

Para poder realizar el an치lisis se han revisado las siguientes fuentes:

**Digital Access Index** El 칈ndice de Acceso Digital es utilizado para medir y evaluar el nivel de acceso a las tecnolog칤as digitales y a internet. Proporciona una medida de hasta qu칠 punto las personas y las comunidades pueden utilizar y beneficiarse de las tecnolog칤as digitales.

**Egov-index** El 칈ndice de Gobierno Electr칩nico es una medida que eval칰a el nivel de desarrollo y adopci칩n de tecnolog칤as de la informaci칩n y la comunicaci칩n (TIC) en el sector p칰blico. Este 칤ndice se utiliza para medir la capacidad de los gobiernos para proporcionar servicios en l칤nea, promover la participaci칩n ciudadana y utilizar las TIC de manera efectiva en la gesti칩n gubernamental.

**Democracy Index** El 칈ndice de Democracia es un 칤ndice que mide el estado de la democracia en pa칤ses de todo el mundo. Es elaborado por The Economist (EIU) y eval칰a el funcionamiento de los procesos e instituciones democr치ticas.

A partir de la informaci칩n recolectada se ha creado una base de datos llamada Egov.

```{r,echo=FALSE, out.width="80%",fig.align="center"}
knitr::include_graphics("PD12_diccionarioEgov.png") 
```

```{r}
library(rio)
Egov=import("EGov.xlsx")
names(Egov)
```

**No olviden el an치lisis descriptivo antes de hacer los modelos.**

## **Modelo 1**

```{r}
library(tidyverse)

modelo1 = lm(accesoInformacion ~participaci칩nDigital+Servicios_Online+Capital_Humano  +Telecommunicacion_Infrastructura+ProcesoElectoral+ Policulture +UsuariosInternet ,data=Egov)
summary(modelo1)
```

## **Interpretamos 游땙**

### **쮼l modelo es v치lido?**

Establezcamos nuestras hip칩tesis:

-   H0: El modelo de regresi칩n no es v치lido
-   H1: El modelo de regresi칩n es v치lido (las variables independientes aportan al modelo)

Luego nos fijamos en el **p-value** Como el p valor es \< 2.2e-16 entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo es v치lido como modelo de predicci칩n.

### **쯈u칠 tanto explica el modelo?**

Observamos el **R2 ajustado**.

Analizar cu치nto de la variabilidad de la variable dependiente (y) es explicada por las variables independientes elegidas, para ello revisamos el R2 (Adjusted R-squared, por ser un modelo lineal m칰ltiple). 

En nuestro modelo, este arroj칩 el valor de 0.9217, por lo que podemos concluir que el modelo explica aproximadamente el 92.2% (0.9217\*100) de la variabilidad en el acceso a la informaci칩n (variable dependiente). En otras palabras, este valor alto de R cuadrado ajustado indica que el modelo se ajusta muy bien a los datos y hace un buen trabajo al explicar la relaci칩n entre las variables independientes y la variable dependiente. Sin embargo, el valor del R cuadrado ajustado no te dice nada sobre la significancia estad칤stica de las variables individuales, ni sobre la causalidad. Por ello analizaremos tambi칠n las variables de forma independiente en el siguiente paso.

*Recordemos que el R cuadrado puede tomar valores entre 0 y 1. Un R cuadrado de 1 indica que el modelo explica toda la variabilidad de la variable Y. Un R cuadrado de 0 indica que el modelo no explica nada de la variabilidad de la variable Y.*

### **쯃as variables aportan al modelo?**

Revisamos **p-value** por cada variable independiente.

-   Esperamos obtener un p-value \<0.05.
-   Nos damos cuenta que *no todas* las variables independientes tienen un p-value \<0.05, es el caso de: participaci칩nDigital y Servicios_Online

### **쮺u치les son los coeficientes de la ecuaci칩n?**

Podemos obtener extraer los coeficientes del modelo: 

*No olvidar identificar el signo de cada coeficiente, este tendr치 repercusi칩n en la ecuaci칩n y su futura aplicaci칩n*

```{r}
modelo1$coefficients
```

De esa manera puedo hallar la ecuaci칩n:

$$
Y = -0.12 + \text{participaci칩nDigital} \times (-0.078) + \text{Servicios\_Online} \times (0.080) + \text{Capital\_Humano} \times (0.29) + \text{Telecommunicacion\_Infrastructura} \times (0.35) + \text{ProcesoElectoral} \times (0.0075) + \text{Policulture} \times (0.013) + \text{UsuariosInternet} \times (0.0015)
$$

Es decir, se tienen las siguientes relaciones entre VD y las VI:

- Por cada unidad adicional de puntaje en participaci칩n digital, el 칤ndice de acceso a la informaci칩n **disminuye en 0.078 puntos** (relaci칩n inversa).

- Por cada unidad adicional de puntaje de servicios online, el 칤ndice de acceso a la informaci칩n **aumenta en 0.08 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje en Capital Humano, el 칤ndice de acceso a la informaci칩n **aumenta en 0.08 puntos** (relaci칩n directa).

- Por cada unidad adicional de puntaje de telecomunicaciones e infraestructura, el 칤ndice de acceso a la informaci칩n **aumenta en 0.35 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Procesos Electorales, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0075 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Cultura pol칤tica, el 칤ndice de acceso a la informaci칩n **aumenta en 0.013 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de acceso de Usuarios a Internet, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0015 puntos**. (relaci칩n directa).

**OJO: La ecuaci칩n de la recta debe incluir TODAS las variables analizadas, tengan o no una influencia significativa en la VD.**

쯈u칠 sucede si retiro las variables independientes que no aportan al modelo 1? Veamos un segundo modelo 游 .

## **Modelo 2**

```{r}
library(dplyr)
library(ggplot2)

modelo2 = lm(accesoInformacion ~Capital_Humano  +Telecommunicacion_Infrastructura+ProcesoElectoral+ Policulture +UsuariosInternet   ,data=Egov)
summary(modelo2)
```

## **Interpretamos 游땙**

### **쮼l modelo es v치lido?**

Establezcamos nuestras hip칩tesis:

-   H0: El modelo de regresi칩n no es v치lido
-   H1: El modelo de regresi칩n es v치lido (las variables independientes aportan al modelo)

Luego nos fijamos en el **p-value** Como el p valor es \< 2.2e-16 entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo s칤 es v치lido como modelo de predicci칩n. 

### **쯈u칠 tanto explica el modelo?**

Observamos el **R2 ajustado**.

Analizar cu치nto de la variabilidad de la variable dependiente (y) es explicada por las variables independientes elegidas, para ello revisamos el R2 (Adjusted R-squared).

En nuestro modelo, este arroj칩 el valor de 0.9225, por lo que podemos concluir mi modelo explica aproximadamente el 92.25% (0.9225\*100) de la variabilidad en el acceso a la informaci칩n (variable dependiente). E

### **쯃as variables aportan al modelo?**

Revisamos **p-value** por cada variable independiente.

-   Esperamos obtener un p-value \<0.05.
-   *Todas* las variables independientes aportan al modelo.

### **쮺u치les son los coeficientes de la ecuaci칩n?**

```{r}
modelo2$coefficients
```

De esa manera puedo hallar la ecuaci칩n:

$$
Y = -0.12 + \text{Capital\_Humano} \times (0.288) + \text{Telecommunicacion\_Infrastructura} \times (0.35) + \text{ProcesoElectoral} \times (0.00758) + \text{Policulture} \times (0.0145) + \text{UsuariosInternet} \times (0.0016)
$$
En este modelo, las variables se interpretan de la siguiente manera:

- Por cada unidad adicional de puntaje en Capital Humano, el 칤ndice de acceso a la informaci칩n **aumenta en 0.288 puntos** (relaci칩n directa).

- Por cada unidad adicional de puntaje de telecomunicaciones e infraestructura, el 칤ndice de acceso a la informaci칩n **aumenta en 0.35 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Procesos Electorales, el 칤ndice de acceso a la informaci칩n **aumenta en 0.00758 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Cultura pol칤tica, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0145 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de acceso de Usuarios a Internet, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0016 puntos**. (relaci칩n directa).

쯄i modelo ha mejorado?

Ligeramente, mientras que el modelo 1 explicaba un 92.17% y el modelo 2 92.25%. A pesar de que mi modelo 1 tiene un rango de explicaci칩n alto, con el modelo 2 se ha podido demostrar que el modelo puede mejorar (as칤 la mejora no ha haya sido sustancial).

Tambi칠n es importante notar que los coeficientes estimados de las VI han cambiado.

### **Predicci칩n**

Si el puntaje en CapitalHumano es 0.8, de telecomunicaciones e infraestructura es 0.6, de proceso electoral y cultura pol칤tica de 9 y de Usuarios de internet es de 56.

**Y = -0.12 + 0.29(0.8) + 0.35(0.6) + 0.01 (9) + 0.01 (9) + 0.002(56)**

**Y = -0.12 + 0.232 + 0.21 + 0.09 + 0.09 + 0.112**

**Y = 0.614**

```{r}
predict(modelo2, data.frame(Capital_Humano = 0.8, Telecommunicacion_Infrastructura = 0.6, ProcesoElectoral = 9, Policulture = 9, UsuariosInternet = 56))
```

En este caso, el 칤ndice de acceso a la informaci칩n es de **0.614** puntos.

### **쯈u칠 variable aporta m치s?**

Para interpretar c칩mo cada variable independiente contribuye a la variabilidad de la variable dependiente (accesoInformacion), podemos usar los coeficientes estandarizados. Estos coeficientes nos ayudan a comparar, en una misma escala, el impacto que tiene cada variable independiente sobre la variable dependiente, permiti칠ndonos identificar cu치les tienen un efecto m치s fuerte.

```{r}
library(lm.beta)
lm.beta(modelo2)
```
Los resultados anteriores nos demuestran que las variables con mayor impacto son Telecommunicacion_Infrastructura (0.37) y Capital_Humano (0.27).

## **Qu칠 factores determinan la calidad de sue침o del personal de salud en pandemia**

La pandemia de COVID-19 tuvo una repercusi칩n significativa en el personal de salud en todo el mundo. Los trabajadores de la salud estuvieron en la primera l칤nea de batalla, enfrentando desaf칤os sin precedentes. Adem치s de los riesgos f칤sicos, el personal de salud enfrent칩 una carga emocional y psicol칩gica abrumadora. Una de las principales preocupaciones era la calidad del sue침o del personal de salud, pues pod칤a repercutir directamente en la calidad de atenci칩n de los pacientes. 

-   edad
-   genero: 0 = "Mujer", 1 = "Hombre"
-   primera_linea: 쯉e encentra en la primera l칤nea de atenci칩n del Covid-19? (0 = "No", 1 = "Si")
-   trabajo_casa: 쯊rabaja desde casa? (0 = "No", 1 = "Si")
-   ni침os_casa: 쯊iene ni침os en casa? (0 = "No", 1 = "Si")
-   promedio_sue침o: 쮺uantas horas ha dormido en promedio la semana pasada?

```{r}
Covid=import("data_covid.csv")
```

```{r}
str(Covid)
```

Reviso las variables dicot칩micas genero, primera_linea, trabajo_casa y ni침os_casa

```{r}
table(Covid$genero)
table(Covid$primera_linea)
table(Covid$trabajo_casa)
table(Covid$ni침os_casa)
```

**OJO: como esta vez las variables son dicot칩micas tratadas como num칠ricas, la interpretamos de la siguiente manera:**

- Si alguien es hombre, se multiplica el coeficiente por 1. Si se es mujer, se multiplica dicho coeficiente por 0. 

- Si alguien perteneci칩 a primera l칤nea, se multiplica dicho coeficiente estimado por 1. Si no ha sido de primera l칤nea, se multiplica por 0.

- Si alguien trabaja desde casa, se multiplica dicho coeficiente estimado por 1. Si no ha trabajado desde casa, se multiplica por 0.

- Si alguien tiene hijos en casa, se multiplica dicho coeficiente estimado por 1. Si no los tiene, se multiplica por 0.

## **Modelo 3**

Hacemos uso de todas las variables de la base de datos. Veamos los resultados.

```{r}
modelo3 = lm(promedio_sue침o ~ edad + genero + primera_linea + trabajo_casa + ni침os_casa, data=Covid)
summary(modelo3)
```

## **Interpretamos 游땙**

### **쮼l modelo es v치lido?**

Establezcamos nuestras hip칩tesis:

-   H0: El modelo de regresi칩n no es v치lido
-   H1: El modelo de regresi칩n es v치lido (variables independientes aportan al modelo)

Luego nos fijamos en el **p-value** Como el p valor es 7.486e-07, entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo s칤 es v치lido como modelo de predicci칩n.

### **쯈u칠 tanto explica el modelo?**

Observamos el **R2 ajustado**.

Analizar cu치nto de la variabilidad de la variable dependiente (y) es explicada por las variables independientes elegidas, para ello revisamor el R2 (Adjusted R-squared).

En nuestro modelo, este arroj칩 el valor de 0.09483 , por lo que podemos concluir el modelo explica aproximadamente el 9.48% de la variabilidad en el promedio de las horas de sue침o del personal de salud (variable dependiente).

### **쯃as variables aportan al modelo?**

Revisamos **p-value** por cada variable independiente.

-   Esperamos obtener un p-value \<0.05.
-   Esta vez las variables que **s칤 aportan** al modelo son: primera l칤nea contra Covid y Tiene ni침os en casa.

### **쮺u치les son los coeficientes de la ecuaci칩n?**

Coeficientes:

```{r}
modelo3$coefficients
```

De esa manera puedo hallar la ecuaci칩n:

$$
Y = 7.2635 + \text{Edad} \times (0.0002) + \text{Genero} \times (0.1167) + \text{Primera l칤nea} \times (-0.9295) + \text{Trabaja desde casa} \times (0.0814) + \text{Tiene ni침os en casa} \times (-0.5412)
$$ 

쮺칩mo interpretamos los coeficientes en este caso?

- Por cada a침o adicional de edad, el tiempo de sue침o **aumenta en 0.0002 horas** (relaci칩n directa).

- Si la persona es hombre, su tiempo de sue침o **aumenta en 0.1167 horas** (relaci칩n directa).

- Si la persona ha estado en primera l칤nea en la lucha contra la pandemia de Covid, su tiempo de sue침o **disminuye en 0.9295 horas de sue침o** (relaci칩n inversa).

- Si la persona trabaja desde casa, su tiempo de sue침o **aumenta en 0.0814 horas** (relaci칩n directa).

- Si la persona tiene ni침os en su casa, su tiempo de sue침o **disminuye en 0.5412 horas** (relaci칩n inversa).

**쯈u칠 sucede si retiramos aquellas variables que no aportan al modelo?** Hagamos un siguiente modelo.

## **Modelo 4**

Aplicamos el **principio de parsimonia** para crear un nuevo modelo solo con las variables que aportan.

```{r}
modelo4 = lm(promedio_sue침o ~ primera_linea + ni침os_casa ,data=Covid)
summary(modelo4)
```

## **Interpretamos 游땙**

### **쮼l modelo es v치lido?**

Establezcamos nuestras hip칩tesis:

-   H0: El modelo de regresi칩n no es v치lido
-   H1: El modelo de regresi칩n es v치lido (variables independientes aportan al modelo)

Luego nos fijamos en el **p-value** Como el p valor es 1.375e-08 entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo s칤 es v치lido como modelo de predicci칩n. 

### **쯈u칠 tanto explica el modelo?**

Observamos el **R2 ajustado**.

Analizar cu치nto de la variabilidad de la variable dependiente (y) es explicada por las variables independientes elegidas, para ello revisamor el R2 (Adjusted R-squared).

En nuestro modelo, este arroj칩 el valor de 0.102 , por lo que podemos concluir mi modelo explica aproximadamente el 10.2% de la variabilidad en el promedio de las horas de sue침o del personal de salud (variable dependiente). 

### **쯃as variables aportan al modelo?** 游뱂

Revisamos **p-value** por cada variable independiente.

-   Esperamos obtener un p-value \<0.05.
-   Todas las variables *aportan* al modelo.

### **쮺u치les son los coeficientes de la ecuaci칩n?**

```{r}
modelo4$coefficients
```

De esa manera puedo hallar la ecuaci칩n:

$$
Y = 7.35  + \text{Primera linea} \times (-0.97) +  \text{Tiene ni침os en casa} \times (-0.54)
$$ 

En este caso, los coeficientes se interpretan de la siguiente manera:

- Si la persona perteneci칩 a la primera l칤nea de lucha contra la pandemia de Covid, su tiempo de sue침o **disminuye en 0.97 horas** (relaci칩n inversa).

- Si la persona tiene ni침os en casa, su tiempo de sue침o **disminuye en 0.54 horas** (relaci칩n inversa).

쯄i modelo ha mejorado?

Ligeramente: el R2 ajustado, de 0.0948 (9.48%), subi칩 a 0.102 (10.2%) al momento de explicar la variabilidad de horas de sue침o de las personas.

### **Predicci칩n**

Supondiendo que alguien **NO es de primera l칤nea** y **SI tiene ni침os en casa**:

**Y = 7. 35 - 0.97(0) - 0.54(1)**

**Y = 7.35 - 0.54**

**Y = 6.81**

```{r}
predict(modelo4,data.frame(primera_linea=0,ni침os_casa=1))
```

Se interpreta de la siguiente manera: si alguien no es de primera l칤nea y s칤 tiene ni침os en casa, sus horas de sue침o ser치n, aproximadamente, **6.81 horas**.

# Ejercicio

Utiliza la base fsi_democracy.xlsx y crea un modelo de regresi칩n m칰ltiple para analizar el impacto de las distintas variables en la Fragilidad del Estado (Total). 

En este caso, las variables independientes que usaremos para predecir la Fragilidad del Estado ser치n:
Aparato_seguridad 
Economia
Servicios_publicos
Intervencion_externa

Adem치s, crea una variable dicot칩mica a partir de la columna Tipo_regimen, que indique si el Estado es autoritario o no:
- Si el Estado es autoritario, asigna el valor 1.
- Si el Estado no es autoritario, asigna el valor 0.

Predice la Fragilidad de un Estado que tiene 5 en aparato de seguridad, 8 en econom칤a, 7 en servicios p칰blicos, 4 en intervenci칩n externa y que NO es un regimen autoritario


