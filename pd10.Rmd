---
title: "Pr치ctica dirigida 10"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 1
    theme: cosmo
    highlight: textmate
    always_allow_html: yes
  pdf_document:
    toc: yes
    toc_depth: '1'
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

# **Regresi칩n linea m칰ltiple**

Hasta el momento, nos hemos encontrado en el campo del an치lisis bivariado. Sin embargo, en el mundo social, dif칤cilmente se pueden explicar los fen칩menos de inter칠s con una sola variable. Incluso si nos interesa evaluar el efecto de un a variable en espec칤fico sobre un fen칩meno de estudio, hay muchos otros factores que podr칤an influir en aquello que nos interesa explorar. Por ello, necesitamos recurrir al **an치lisis multivariado** y conocer el concepto de **control estad칤stico**. 

El control estad칤stico nos permite aislar el efecto de otras variables. La idea es:

* Evaluar si la asociaci칩n entre X e Y permanece si se remueve el efecto de otra variable, es decir, si se controla por una tercera variable.

* Se analiza la relaci칩n entre X e Y para valores similares o iguales de una variable Z. De esta manera se elimina la influencia de Z en la relaci칩n entre X e Y. Lo anterior nos ayuda a acercarnos a una interpretaci칩n causar X -> Y.

* Si la relaci칩n entre X e Y desaparece cuando se controla por Z, se dice que la relaci칩n era esp칰rea. En otras palabras, la relaci칩n dependendia de la influencia de Z y no de una conexi칩n directa entre X e Y.  

Sobre la regresi칩n lineal m칰ltiple: 

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("pd12_diap1.png") 
```

------------------------------------------------------------------------

Seguiremos los siguientes pasos para el an치lisis: 

```{r,echo=FALSE, out.width="100%",fig.align="center"}
knitr::include_graphics("pd12_diap2.png") 
```

# Aplicaci칩n pr치ctica

## **Factores que determinan el acceso a la informaci칩n en los Estados**

El acceso a la informaci칩n es fundamental para el funcionamiento de cualquier Estado democr치tico, ya que promueve la transparencia, la responsabilidad y la participaci칩n ciudadana. 

Para poder realizar el an치lisis se han revisado las siguientes fuentes:

**Digital Access Index** El 칈ndice de Acceso Digital es utilizado para medir y evaluar el nivel de acceso a las tecnolog칤as digitales y a internet. Proporciona una medida de hasta qu칠 punto las personas y las comunidades pueden utilizar y beneficiarse de las tecnolog칤as digitales.

**Egov-index** El 칈ndice de Gobierno Electr칩nico es una medida que eval칰a el nivel de desarrollo y adopci칩n de tecnolog칤as de la informaci칩n y la comunicaci칩n (TIC) en el sector p칰blico. Este 칤ndice se utiliza para medir la capacidad de los gobiernos para proporcionar servicios en l칤nea, promover la participaci칩n ciudadana y utilizar las TIC de manera efectiva en la gesti칩n gubernamental.

**Democracy Index** El 칈ndice de Democracia es un 칤ndice que mide el estado de la democracia en pa칤ses de todo el mundo. Es elaborado por The Economist (EIU) y eval칰a el funcionamiento de los procesos e instituciones democr치ticas.

A partir de la informaci칩n recolectada se ha creado una base de datos llamada Egov.

```{r,echo=FALSE, out.width="80%",fig.align="center"}
knitr::include_graphics("PD12_diccionarioEgov.png") 
```

```{r}
library(rio)
Egov=import("EGov.xlsx")
names(Egov)
```

**No olviden el an치lisis descriptivo antes de hacer los modelos.**

## **Modelo 1**

```{r}
library(tidyverse)

modelo1 = lm(accesoInformacion ~participaci칩nDigital+Servicios_Online+Capital_Humano  +Telecommunicacion_Infrastructura+ProcesoElectoral+ Policulture +UsuariosInternet ,data=Egov)
summary(modelo1)
```

## **Interpretamos 游땙**

### **쮼l modelo es v치lido?**

Establezcamos nuestras hip칩tesis:

-   H0: El modelo de regresi칩n no es v치lido
-   H1: El modelo de regresi칩n es v치lido (las variables independientes aportan al modelo)

Luego nos fijamos en el **p-value** Como el p valor es \< 2.2e-16 entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo es v치lido como modelo de predicci칩n.

### **쯈u칠 tanto explica el modelo?**

Observamos el **R2 ajustado**.

Analizar cu치nto de la variabilidad de la variable dependiente (y) es explicada por las variables independientes elegidas, para ello revisamos el R2 (Adjusted R-squared, por ser un modelo lineal m칰ltiple). 

En nuestro modelo, este arroj칩 el valor de 0.9217, por lo que podemos concluir que el modelo explica aproximadamente el 92.2% (0.9217\*100) de la variabilidad en el acceso a la informaci칩n (variable dependiente). En otras palabras, este valor alto de R cuadrado ajustado indica que el modelo se ajusta muy bien a los datos y hace un buen trabajo al explicar la relaci칩n entre las variables independientes y la variable dependiente. Sin embargo, el valor del R cuadrado ajustado no te dice nada sobre la significancia estad칤stica de las variables individuales, ni sobre la causalidad. Por ello analizaremos tambi칠n las variables de forma independiente en el siguiente paso.

*Recordemos que el R cuadrado puede tomar valores entre 0 y 1. Un R cuadrado de 1 indica que el modelo explica toda la variabilidad de la variable Y. Un R cuadrado de 0 indica que el modelo no explica nada de la variabilidad de la variable Y.*

### **쯃as variables aportan al modelo?**

Revisamos **p-value** por cada variable independiente.

-   Esperamos obtener un p-value \<0.05.
-   Nos damos cuenta que *no todas* las variables independientes tienen un p-value \<0.05, es el caso de: participaci칩nDigital y Servicios_Online

### **쮺u치les son los coeficientes de la ecuaci칩n?**

Podemos obtener extraer los coeficientes del modelo: 

*No olvidar identificar el signo de cada coeficiente, este tendr치 repercusi칩n en la ecuaci칩n y su futura aplicaci칩n*

```{r}
modelo1$coefficients
```

De esa manera puedo hallar la ecuaci칩n:

$$
Y = -0.12 + \text{participaci칩nDigital} \times (-0.078) + \text{Servicios\_Online} \times (0.080) + \text{Capital\_Humano} \times (0.29) + \text{Telecommunicacion\_Infrastructura} \times (0.35) + \text{ProcesoElectoral} \times (0.0075) + \text{Policulture} \times (0.013) + \text{UsuariosInternet} \times (0.0015)
$$

Es decir, se tienen las siguientes relaciones entre VD y las VI:

- Por cada unidad adicional de puntaje en participaci칩n digital, el 칤ndice de acceso a la informaci칩n **disminuye en 0.078 puntos** (relaci칩n inversa).

- Por cada unidad adicional de puntaje de servicios online, el 칤ndice de acceso a la informaci칩n **aumenta en 0.08 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje en Capital Humano, el 칤ndice de acceso a la informaci칩n **aumenta en 0.08 puntos** (relaci칩n directa).

- Por cada unidad adicional de puntaje de telecomunicaciones e infraestructura, el 칤ndice de acceso a la informaci칩n **aumenta en 0.35 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Procesos Electorales, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0075 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Cultura pol칤tica, el 칤ndice de acceso a la informaci칩n **aumenta en 0.013 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de acceso de Usuarios a Internet, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0015 puntos**. (relaci칩n directa).

**OJO: La ecuaci칩n de la recta debe incluir TODAS las variables analizadas, tengan o no una influencia significativa en la VD.**

쯈u칠 sucede si retiro las variables independientes que no aportan al modelo 1? Veamos un segundo modelo 游 .

## **Modelo 2**

```{r}
library(dplyr)
library(ggplot2)

modelo2 = lm(accesoInformacion ~Capital_Humano  +Telecommunicacion_Infrastructura+ProcesoElectoral+ Policulture +UsuariosInternet   ,data=Egov)
summary(modelo2)
```

## **Interpretamos 游땙**

### **쮼l modelo es v치lido?**

Establezcamos nuestras hip칩tesis:

-   H0: El modelo de regresi칩n no es v치lido
-   H1: El modelo de regresi칩n es v치lido (las variables independientes aportan al modelo)

Luego nos fijamos en el **p-value** Como el p valor es \< 2.2e-16 entonces podemos afirmar que hay suficiente evidencia para rechazar la H0, por lo que concluimos que el modelo s칤 es v치lido como modelo de predicci칩n. 

### **쯈u칠 tanto explica el modelo?**

Observamos el **R2 ajustado**.

Analizar cu치nto de la variabilidad de la variable dependiente (y) es explicada por las variables independientes elegidas, para ello revisamos el R2 (Adjusted R-squared).

En nuestro modelo, este arroj칩 el valor de 0.9225, por lo que podemos concluir mi modelo explica aproximadamente el 92.25% (0.9225\*100) de la variabilidad en el acceso a la informaci칩n (variable dependiente). E

### **쯃as variables aportan al modelo?**

Revisamos **p-value** por cada variable independiente.

-   Esperamos obtener un p-value \<0.05.
-   *Todas* las variables independientes aportan al modelo.

### **쮺u치les son los coeficientes de la ecuaci칩n?**

```{r}
modelo2$coefficients
```

De esa manera puedo hallar la ecuaci칩n:

$$
Y = -0.12 + \text{Capital\_Humano} \times (0.288) + \text{Telecommunicacion\_Infrastructura} \times (0.35) + \text{ProcesoElectoral} \times (0.00758) + \text{Policulture} \times (0.0145) + \text{UsuariosInternet} \times (0.0016)
$$
En este modelo, las variables se interpretan de la siguiente manera:

- Por cada unidad adicional de puntaje en Capital Humano, el 칤ndice de acceso a la informaci칩n **aumenta en 0.288 puntos** (relaci칩n directa).

- Por cada unidad adicional de puntaje de telecomunicaciones e infraestructura, el 칤ndice de acceso a la informaci칩n **aumenta en 0.35 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Procesos Electorales, el 칤ndice de acceso a la informaci칩n **aumenta en 0.00758 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de Cultura pol칤tica, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0145 puntos**. (relaci칩n directa).

- Por cada unidad adicional de puntaje de acceso de Usuarios a Internet, el 칤ndice de acceso a la informaci칩n **aumenta en 0.0016 puntos**. (relaci칩n directa).

쯄i modelo ha mejorado?

Ligeramente, mientras que el modelo 1 explicaba un 92.17% y el modelo 2 92.25%. A pesar de que mi modelo 1 tiene un rango de explicaci칩n alto, con el modelo 2 se ha podido demostrar que el modelo puede mejorar (as칤 la mejora no ha haya sido sustancial).

Tambi칠n es importante notar que los coeficientes estimados de las VI han cambiado.

### **Predicci칩n**

쮺u치l ser칤a el 칤ndice de acceso a la informaci칩n si reemplazamos el puntaje de cada variable independiente con su respectivo promedio? 

```{r}
Egov %>%
  summarise(mean(Capital_Humano, na.rm=T), mean(Telecommunicacion_Infrastructura, na.rm=T), 
            mean(ProcesoElectoral, na.rm=T), mean(Policulture, na.rm=T), mean(UsuariosInternet, na.rm=T))
```


**Y = -0.12 + 0.29(0.64) + 0.35(0.38) + 0.01 (6.17) + 0.01 (5.73) + 0.002(49.65)**

**Y = -0.12 + 0.186 + 0.133 + 0.062 + 0.057 + 0.099**

**Y = 0.417**

```{r}
predict(modelo2, data.frame(Capital_Humano = 0.64, Telecommunicacion_Infrastructura = 0.38, ProcesoElectoral = 6.17, Policulture = 5.73, UsuariosInternet = 49.65))
```

En conclusi칩n, para valores promedio de las variables independientes, el 칤ndice de acceso a la informaci칩n es de **0.41** puntos.

쯈u칠 pasa si queremos predecir el 칤ndice de acceso a la informaci칩n para diferentes valores de una variable independiente?

En este caso, se puede reemplazar dejando las otras variables en el promedio. Por ejemplo, se quiere calcular el 칤ndice de acceso a la informaci칩n para diferentes valores de la telecomunicaci칩n e infraestuctura. Lo primero es calcular los valores a reemplazar. En este caso usaremos el m칤nimo, la mediana y el m치ximo.

```{r}
Egov %>%
  summarise(min(Telecommunicacion_Infrastructura, na.rm=T), 
            median(Telecommunicacion_Infrastructura, na.rm=T), max(Telecommunicacion_Infrastructura, na.rm=T))
```
Luego, podemos reemplazar estos diferentes valores de telecomunicaciones e infraestructura, dejando las otras dos variables constantes en el promedio.

Usando el m칤nimo:
```{r}
predict(modelo2, data.frame(Capital_Humano = 0.64, Telecommunicacion_Infrastructura = 0, ProcesoElectoral = 6.17, Policulture = 5.73, UsuariosInternet = 49.65))
```

Usando la mediana:
```{r}
predict(modelo2, data.frame(Capital_Humano = 0.64, Telecommunicacion_Infrastructura = 0.35, ProcesoElectoral = 6.17, Policulture = 5.73, UsuariosInternet = 49.65))
```

Usando el m치ximo:
```{r}
predict(modelo2, data.frame(Capital_Humano = 0.64, Telecommunicacion_Infrastructura = 0.84, ProcesoElectoral = 6.17, Policulture = 5.73, UsuariosInternet = 49.65))
```

### **쯈u칠 variable aporta m치s?**

Para interpretar c칩mo cada variable independiente contribuye a la variabilidad de la variable dependiente (accesoInformacion), podemos usar los coeficientes estandarizados. Estos coeficientes nos ayudan a comparar, en una misma escala, el impacto que tiene cada variable independiente sobre la variable dependiente, permiti칠ndonos identificar cu치les tienen un efecto m치s fuerte.

```{r}
library(jtools)
summ(modelo2, scale=T)
```
Los resultados anteriores nos demuestran que las variables con mayor impacto son Telecommunicacion_Infrastructura (0.08) y Capital_Humano (0.06)

```{r}
plot_summs(modelo2, scale = T)
```

# Ejercicio para clase

Utiliza la base fsi_democracy.xlsx y crea un modelo de regresi칩n m칰ltiple para analizar el impacto de las distintas variables en la Fragilidad del Estado (Total). 

En este caso, las variables independientes que usaremos para predecir la Fragilidad del Estado ser치n:
Aparato_seguridad 
Economia
Servicios_publicos
Intervencion_externa

Predice la Fragilidad de un Estado que usando valores significativos para cada variable independiente. 
