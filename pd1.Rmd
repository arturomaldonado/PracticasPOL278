---
title: "Pr√°ctica dirigida 1"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: cosmo
    highlight: textmate
    always_allow_html: true
---

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estad√≠stica para el an√°lisis pol√≠tico 1 \| Semestre 2024 - 2 <br>

------------------------------------------------------------------------

## **Introducci√≥n a R**

<a id='beginning'></a>

<a id='part1'></a>

# **1. ¬øQu√© es R?**

R es un lenguaje de programaci√≥n y un entorno de software libre y de c√≥digo abierto utilizado para an√°lisis estad√≠stico y visualizaci√≥n de datos. Fue desarrollado por Ross Ihaka y Robert Gentleman en la Universidad de Auckland, Nueva Zelanda, en 1993. Desde entonces, ha sido ampliamente adoptado por la comunidad cient√≠fica y empresarial como una herramienta esencial para el an√°lisis y la visualizaci√≥n de datos.

R cuenta con una amplia variedad de paquetes y bibliotecas que permiten el an√°lisis estad√≠stico, la miner√≠a de datos, el aprendizaje autom√°tico, la visualizaci√≥n de datos y la generaci√≥n de informes. Adem√°s, su sintaxis es relativamente sencilla, lo que facilita su aprendizaje y uso para personas con distintos niveles de experiencia en programaci√≥n, lo cual ha significado su uso en diversos rubros.

```{r echo=FALSE}
library(vembedr)

embed_youtube("ZCQHm63xc4s")
```

------------------------------------------------------------------------

<a id='part2'></a>

# **2. ¬øQu√© podemos hacer con R?**

![](QphacerR1.png)

![](QphacerR2.png)

![](QphacerR3.png)

![](QphacerR4.png)

------------------------------------------------------------------------

<a id='part3'></a>

# **3. Conceptos b√°sicos para programar en R**

Instalar [R](http://www.r-project.org)

Instalar [RStudio](https://posit.co/downloads/)

### Usando R

![](PrograR.png)

#### **3.1. Configurar el directorio de trabajo**

R funciona como un entorno temporal de trabajo, lo que quiere decir que el usuario va agregando datos y objetos. Sin embargo, si los an√°lisis no son guardados se deber√°n repetir las instrucciones para obtener otra vez el resultado. Por esta raz√≥n, es preciso configurar una carpeta predeterminada en nuestro ordenador, donde el programa buscar√° los archivos a ejecutar y guardar√° los archivos a conservar con cambios.

Para ver nuestro lugar de trabajo actual escribimos el siguiente comando (escriba el c√≥digo en la consola, ya que si lo ejecuta desde este Rmd, obtendr√° el lugar donde se encuentra este archivo):

```{r}
getwd() #para saber en qu√© carpeta est√° el archivo
```

Si queremos cambiar de directorio de trabajo, nos dirigirnos al men√∫ **"Session" \> "Set Working Directory" \> "Choose Directory"**. Esto abrir√° una ventana emergente, donde buscaremos la carpeta en la cual vamos a trabajar, la ubicamos y seleccionamos "Open". Para verificar el cambio volvemos a digitar la funci√≥n **"getwd()"** en la consola.

#### **3.2. Sintaxis y objetos en R**

El uso de R es bastante intuitivo y sigue un patr√≥n l√≥gico. Est√° compuesto de c√≥digos y la combinaci√≥n de estos c√≥digos genera una sintaxis. Asimismo, R guarda la informaci√≥n de nuestras observaciones y variables a trav√©s de objetos.

En un sentido global, la estructura general de una sintaxis puede resumirse como sigue: a un objeto dado se le asigna el resultado de una funci√≥n, que a su vez se ejecuta sobre un conjunto de datos especificado, con una serie de configuraciones particulares. Veamos el siguiente ejemplo ficticio.

![](Sintax.png)

Si se lee de izquierda a derecha, la l√≠nea de comando puede explicarse como sigue:

-   Primero se indica un objeto a crear, con el nombre que ustedes definan.

-   Luego se indica el asignador, que expresa que todo lo que est√© a la derecha de la flecha se guardar√° en el objeto creado a la izquierda. El asignador puede ser "\<-" o tambi√©n "=", para motivos del curso usaremos este √∫ltimo.

-   Luego viene la funci√≥n que en este caso permite leer archivos tipo Microsoft Excel. R trabaja con funciones que est√°n dentro de "paquetes" que la comunidad va desarrollando. Podemos hacer nuestras operaciones con diversas funciones, y no hay una sola forma de hacerlo. Si se trata de funciones que no est√°n predeterminadas en R, debemos instalar el paquete que las contiene con el comando "install.packages()", y antes de ejecutarla debemos abrir la libreria con el comando "library()"

-   Luego de la funci√≥n, se abre un par√©ntesis que contiene los argumentos: instrucciones que especifican ciertos detalles de lo que queramos que la funci√≥n realice. Los argumentos pueden escribirse de distintas maneras y va a depender de lo que queramos hacer. En nuestro ejemplo: El primer argumento indica la informaci√≥n a leer, en este caso indica un archivo de tipo Excel (extensi√≥n xlsx). El segundo argumento indica la hoja del archivo a leer. El tercer argumento indica qu√© columnas se leer√°n de forma espec√≠fica (en este caso, las primeras diez).

**Hagamos un ejemplo:**

Vamos a abrir un archivo en R, utilizando la funci√≥n "import" del paquete "rio", el cual es un paquete vers√°til que nos permite importar datos de diversas extensiones (dta, sav, csv, xls, etc.)

Antes que todo, debemos instalar el paquete escribiendo en la consola: `install.packages("rio")`

Tambi√©n podemos instalar un paquete haciendo clic en "Tools" en la barra superior" y luego en "Install packages", se escribe el nombre del paquete a instalar y listo.

```{r}
library(rio)  
data=import("DemocracyIndex2022.xlsx") 
```

Utilizamos la funci√≥n import (importar) que crear√° un objeto que contenga la base de datos del archivo "DemocracyIndex2022.xlsx" la cual hemos descargado. Podemos verificar la creaci√≥n del objeto en el environment (ventana derecha superior), debe encontrarse bajo el nombre de **data**.

Podemos conocer el tipo de objeto que tenemos si usamos el comando **class.** Se puede aplicar a cualquier objeto o variable dentro de un objeto. Entre par√©ntesis colocamos el nombre del objeto. En este caso, se trata de un "data frame", que es el tipo de objeto en R para las bases de datos.

```{r}
class(data) 
```

Podemos realizar el mismo ejercicio con una variable en espec√≠fico. En el lenguaje de base de R, usamos el **s√≠mbolo \$** como sin√≥nimo de pertenencia. Es as√≠ que para referirnos a una variable debemos hacerlo indicando primero la base u objeto al que pertenece, el s√≠mbolo \$, y luego la variable en cuesti√≥n **(data\$variable)**

Hagamos el ejercicio con la variable Categor√≠as.

```{r}
class(data$Categor√≠as)
```

El anterior comando le pide a R, que indique el tipo de la variable **Categor√≠as** que **pertenece** al objeto llamado **data**.

#### **3.3. El mundo tidyverse**

Hay una excepci√≥n al uso de la estructura anterior y es al usar alg√∫n paquete de **tidyverse**.

Tidyverse es un conjunto de de paquetes de R para ciencia de datos, nos ayuda a trabajar las bases de datos. Para importar datos tenemos readr, haven y readxl. Para limpiar los datos usamos tidyr, para transformar los datos se usa dyplr, que lo veremos a continuaci√≥n, para modelar se usa purr o broom, para visualizar se usa ggplot2. Finalmente, para comunicar se usa knitr para publicar los resultados por html, pdf, ppt. y rmarkdown es la estructura de knitr.

Para el curso solo usaremos **dplyr**.

El paquete dplyr es el m√°s √∫til en R para la manipulaci√≥n de datos, una de las ventajas es que se pueda usar el pipe (%\>%) para combinar diferentes funciones en R. En el caso de ggplot2, concatenaremos con el s√≠mbolo "+" .

Como mencionamos, este conjunto de paquetes tiene otra l√≥gica de programaci√≥n. Adem√°s del pipe, otra diferencia es que en este caso indicamos la base al inicio, luego el pipe, y lo sigue la funci√≥n que deseemos ejecutar.

```{r, eval=FALSE,echo=TRUE}
data %>% 
  funcion1() %>% 
  funcion2()
```

La data va en la secci√≥n superior, seguido del pipe. Siempre que deseemos seguir concatenando funciones usaremos "%\>%" al final de cada l√≠nea, hasta que terminemos nuestro c√≥digo.

Algunas de las funciones que veremos en dplyr hoy son

-   summarise: es una funci√≥n que se utiliza para crear res√∫menes estad√≠sticos de un conjunto de datos. Summarise necesita de dos argumentos b√°sicos: el dato que queremos obtener (promedio, conteo, minimo, maximo) y la variable de la que lo queremos obtener

-   group_by: agrupa los resultados del comando que le sigue. Se debe incluir como argumento una variable categ√≥rica y siempre ir√° acompa√±ado de otra funci√≥n.

# **4. An√°lisis descriptivo en R**

```{=html}
<style>
.custom-text {
  color: #00688B;
  font-family: Helvetica, sans-serif;
  text-align: center;
  font-weight: bold;
  font-size: 22px;
}
</style>
```
::: custom-text
¬øCu√°l es el estado de la democracia en el mundo?
:::

![](Portada%20DI_2022.png)

El √≠ndice de democracia (Democracy Index) es un √≠ndice que mide la calidad de la democracia en el mundo. Mide diversas categor√≠as como libertades civiles, cultura pol√≠tica, pluralismo electoral, etc. A partir de estas variables, se obtiene un puntaje promedio, el cual determina el puesto del pa√≠s a nivel mundial, as√≠ como el tipo de r√©gimen que tiene cada uno.

En esta ocasi√≥n, usaremos la base de datos del informe de 2022, publicado por The Economist Inteligence Unit (EIU). El link es el que se muestra a continuaci√≥n: **"<https://www.eiu.com/n/campaigns/democracy-index-2022/>"**

Ahora, toca responder la pregunta de investigaci√≥n.

**¬°Manos a la obra!**

Es necesario saber el tipo de variable que vamos a trabajar. Por ello, exploramos las variables que tiene nuestra base de datos:

-   **chr, factor** -\> variable nominal
-   **ordered factor** -\> variable ordinal
-   **num, int** -\> variable num√©rica

```{r}
names(data)
str(data)
```

El contenido de cada variable lo podemos observar en el siguiente **diccionario de datos**:

| Nombre de variable              | Descripci√≥n                                            |
|---------------------------|---------------------------------------------|
| **Pais**                        | Nombre del pa√≠s                                        |
| **Puntaje**                     | Puntaje promedio del pa√≠s                              |
| **Rank**                        | Puesto del pa√≠s en el indice por puntaje promedio      |
| **Change_rank_previous_year**   | Comparaci√≥n de puesto actual respecto del a√±o anterior |
| **Electoral_process_pluralism** | Puntaje de medici√≥n de pluralismo pol√≠tico-electoral   |
| **Functioning_government**      | Puntaje de medici√≥n del funcionamiento del gobierno    |
| **Political_participation**     | Puntaje de medici√≥n de participaci√≥n pol√≠tica          |
| **Political_culture**           | Puntaje de medici√≥n de la cultura pol√≠tica             |
| **Civil_liberties**             | Puntaje en la medici√≥n de libertades civiles           |
| **Categor√≠as**                  | Tipo de r√©gimen                                        |
| **Continente**                  | Regi√≥n a la que pertenece el pa√≠s analizado            |

## **4.1. ¬øCu√°l es la distribuci√≥n de pa√≠ses por r√©gimen?**

Siempre antes de comenzar a realizar nuestro an√°lisis, debemos identificar la estructura de las variables y verificar que est√©n bien *configuradas*. Es decir que la escala de la variable coincida con el objeto en R.

Por ejemplo, debemos asegurarnos que una variable categ√≥rica no est√© configurada como num√©rica en R, y viceversa.

**Variable "Categor√≠as":**

Queremos saber el tipo de r√©gimen de cada pa√≠s observado. Para ello, realizamos el an√°lisis de la variable en cuesti√≥n `Categor√≠as`

Lo que queremos crear es una tabla de frecuencias. Necesitamos que cuente los casos (en esta data cada caso es un pa√≠s) seg√∫n cada categor√≠a. En otras palabras, cu√°ntos pa√≠ses hay por categor√≠a.

```{r, warning=FALSE,message=FALSE}
library(dplyr)
data %>%
 group_by(Categor√≠as) %>%
  summarise(Freq=n())
```

Se observa que, de los pa√≠ses analizados en el √≠ndice de la democracia, 59 pa√≠ses son coniderados como **Autoritarismo**, 36 como **Reg√≠menes h√≠bridos**, 48 como **Democracia imperfecta** y solo 24 como **Democracia Plena**.

Creemos un gr√°fico de barras para visualizar mejor los pa√≠ses por tipo de r√©gimen.

Ya creamos anteriormente la tabla de frecuencias, pero esta **no fue agregada al environment**. Para hacerlo necesitamos guardarla con un nombre. Necesitamos que tenga uno para poder referirnos a ella al hacer el gr√°fico. **Para ello le agregamos al c√≥digo anterior un "=" y antes del asignado ir√° el nombre del objeto nuevo "para_grafico".**

```{r}
para_grafico=data %>%
 group_by(Categor√≠as) %>%
  summarise(Freq=n())#tabla de frecuencias
```

Es necesario llamar al paquete solo una vez y se podr√° usar en las l√≠neas que vayan despu√©s del llamado.

```{r, warning=FALSE,message=FALSE}
library(ggplot2)
ggplot(para_grafico, aes(x=Categor√≠as, y=Freq, fill=Categor√≠as)) + 
geom_bar(stat = "identity")
```

Lo que estamos haciendo con este c√≥digo es usar el comando ggplot que es el que permite hacer gr√°fico y le indicamos que usaremos la base de datos para_grafico. De ella, en el eje X del gr√°fico ir√° la variable Categor√≠as, en el eje Y la frecuencia (Freq) y el relleno ser√° Categor√≠as. Esto √∫ltimo es para que cada barra tenga un color seg√∫n su valor. Luego, indicamos el tipo de gr√°fico, y le decimos para lograrlo solo debe replicar los valores de la tabla de frecuencias.

Adaptemos el dise√±o del gr√°fico y agreguemos etiquetas, t√≠tulos, y tema.

```{r}
ggplot(para_grafico, aes(x=Categor√≠as, y=Freq , fill=Categor√≠as)) + 
geom_bar(stat = "identity")+
  ggtitle("Distribuci√≥n de pa√≠ses por tipo de r√©gimen") +
  xlab("Tipo de r√©gimen") + ylab("Frecuencia")+
  geom_text(aes(label=round(Freq,1)), vjust=1.30, color="black", size=3)+
  scale_fill_brewer(name="Tipo de R√©gimen",palette="Pastel1")+
  theme(panel.background=element_rect(fill = "white", colour = "white"))
```

Las dem√°s variables son num√©ricas y est√°n configuradas como vectores num√©ricos de n√∫meros enteros (integer), por lo cual lo dejamos as√≠ üò∏.

## **4.2 ¬øCu√°les son las medidas de tendencia central del indicador de democracia de los pa√≠ses?**

Entonces, una vez configurados adecuadamente nuestros **objetos**, pidamos los estad√≠sticos de tendencia central para nuestras variables de inter√©s.

| ¬øCu√°l es el promedio del puntaje de todos los pa√≠ses analizados?

Para ello, usamos el comando `mean` que significa "media o promedio". Recuerda que summarise siempre debe incluir el tipo de resumen o el estad√≠stico que necesitamos.

```{r}
data %>% 
  summarise(media = mean(Puntaje)) 
```

Este resultado quiere decir que el **puntaje promedio de democracia** de todos los pa√≠ses analizados es de 5.29 puntos.

En segundo lugar, calculamos la mediana de los puntajes. Esta medida es m√°s robusta que la media, pues resiste valores extremos.

```{r}
data %>% 
  summarise(mediana = median(Puntaje)) 
```

Esto quiere decir que, hasta la mitad de pa√≠ses analizados tienen una puntuaci√≥n de hasta 5.54 puntos.

**Grafiquemos** üé®

Como la variable `Puntaje` es num√©rica, esta vez pediremos un **histograma**.

```{r, warning=FALSE,message=FALSE}
data %>%
ggplot(aes(x=Puntaje)) + 
geom_histogram() 
```

Si lo queremos personalizar :)

```{r}
data %>%
  ggplot(aes(x = Puntaje)) + 
  geom_histogram(color = "blue", fill = "#90EE90", bins = 30) +
  geom_text(stat = 'bin', aes(y = stat(count), label = stat(count)), vjust = -0.5, size = 3, color = "black") +
  ggtitle("Puntaje promedio por pa√≠s") +
  
  scale_y_continuous(breaks = seq(0, 12, by = 2), labels = seq(0, 12, by = 2)) +
  expand_limits(y = 12) +
  geom_vline(xintercept =  mean(data$Puntaje, na.rm = TRUE), color = "red", linetype = "dashed", size = 1) + # L√≠nea de la media
  geom_vline(xintercept = median(data$Puntaje, na.rm = TRUE), color = "blue", linetype = "dashed", size = 1) + # L√≠nea de la mediana
  theme_minimal()

 
```

El histograma muestra una **distribuci√≥n asim√©trica sesgada con ligero sesgo negativo o a la izquierda**. Esto quiere decir que existe una concentraci√≥n de datos hacia la derecha.

##### Ejercicio 1: 

Ahora t√∫, practica calculando el promedio por continente

```{r, eval = T,echo=F}
data%>%
  group_by(Continente)%>%
  summarise(media=mean(Puntaje))
```

##### Ejercicio 2: 

Realiza la misma operaci√≥n pero usando la mediana

```{r, eval = T,echo=F}
data%>%
  group_by(Continente)%>%
  summarise(mediana=median(Puntaje))
```

Tambi√©n podemos resumir todo en una misma tabla. Este tipo de tabla se llama **Tabla resumen. Solo debemos separar los estad√≠sticos solicitados con una coma.**

```{r}
data%>%
  group_by(Continente)%>%
  summarise(media=mean(Puntaje), mediana=median(Puntaje))
```

##### Ejercicio 3: Escojan una variable num√©rica que no hayamos utilizado y hallen la mediana y la media de dicha variable, por continente.

<br></br>

</style>

<a href="https://raw.githubusercontent.com/arturomaldonado/PracticasPOL278/main/pd1.Rmd" download="NombreDeTuScript.R"> <button>Descargar Pr√°ctica Dirigida 1</button> </a>

<br></br> [Go to page beginning](#beginning)
