---
title: "Pr√°ctica dirigida 1"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: cosmo
    highlight: textmate
    always_allow_html: true
---

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estad√≠stica para el an√°lisis pol√≠tico 1 \| Semestre 2024 - 1 <br>

------------------------------------------------------------------------

## **Introducci√≥n a R**

<a id='beginning'></a>

<a id='part1'></a>

# **1. ¬øQu√© es R?**

R es un lenguaje de programaci√≥n y un entorno de software libre y de c√≥digo abierto utilizado para an√°lisis estad√≠stico y visualizaci√≥n de datos. Fue desarrollado por Ross Ihaka y Robert Gentleman en la Universidad de Auckland, Nueva Zelanda, en 1993. Desde entonces, ha sido ampliamente adoptado por la comunidad cient√≠fica y empresarial como una herramienta esencial para el an√°lisis y la visualizaci√≥n de datos.

R cuenta con una amplia variedad de paquetes y bibliotecas que permiten el an√°lisis estad√≠stico, la miner√≠a de datos, el aprendizaje autom√°tico, la visualizaci√≥n de datos y la generaci√≥n de informes. Adem√°s, su sintaxis es relativamente sencilla, lo que facilita su aprendizaje y uso para personas con distintos niveles de experiencia en programaci√≥n, lo cual ha significado su uso en diversos rubros.

```{r echo=FALSE}
library(vembedr)

embed_youtube("ZCQHm63xc4s")
```

------------------------------------------------------------------------

<a id='part2'></a>

# **2. ¬øQu√© podemos hacer con R?**

![](QphacerR1.png)

![](QphacerR2.png)

![](QphacerR3.png)

![](QphacerR4.png)

------------------------------------------------------------------------

<a id='part3'></a>

# **3. Conceptos b√°sicos para programar en R**

Instalar [R](http://www.r-project.org)

Instalar [RStudio](https://posit.co/downloads/)

### Usando R

![](PrograR.png)

#### **3.1. Configurar el directorio de trabajo**

R funciona como un entorno temporal de trabajo, lo que quiere decir que el usuario va agregando datos y objetos. Sin embargo, si los an√°lisis no son guardados se deber√°n repetir las instrucciones para obtener otra vez el resultado. Por esta raz√≥n, es preciso configurar una carpeta predeterminada en nuestro ordenador, donde el programa buscar√° los archivos a ejecutar y guardar√° los archivos a conservar con cambios.

Para ver nuestro lugar de trabajo actual escribimos el siguiente comando (escriba el c√≥digo en la consola, ya que si lo ejecuta desde este Rmd, obtendr√° el lugar donde se encuentra este archivo):

```{r}
getwd() #para saber en qu√© carpeta est√° el archivo
```

Si queremos cambiar de directorio de trabajo, nos dirigirnos al men√∫ **"Session" \> "Set Working Directory" \> "Choose Directory"**. Esto abrir√° una ventana emergente, donde buscaremos la carpeta en la cual vamos a trabajar, la ubicamos y seleccionamos "Open". Para verificar el cambio volvemos a digitar la funci√≥n **"getwd()"** en la consola.

#### **3.2. Sintaxis y objetos en R**

El uso de R es bastante intuitivo y sigue un patr√≥n l√≥gico. Est√° compuesto de c√≥digos y la combinaci√≥n de estos c√≥digos genera una sintaxis. Asimismo, R guarda la informaci√≥n de nuestras observaciones y variables a trav√©s de objetos.

En un sentido global, la estructura general de una sintaxis puede resumirse como sigue: a un objeto dado se le asigna el resultado de una funci√≥n, que a su vez se ejecuta sobre un conjunto de datos especificado, con una serie de configuraciones particulares. Veamos el siguiente ejemplo ficticio.

![](Sintax.png)

Si se lee de izquierda a derecha, la l√≠nea de comando puede explicarse como sigue:

-   Primero se indica un objeto a crear, con el nombre que ustedes definan.

-   Luego se indica el asignador, que expresa que todo lo que est√© a la derecha de la flecha se guardar√° en el objeto creado a la izquierda. El asignador puede ser "\<-" o tambi√©n "=", para motivos del curso usaremos este √∫ltimo.

-   Luego viene la funci√≥n que en este caso permite leer archivos tipo Microsoft Excel. R trabaja con funciones que est√°n dentro de "paquetes" que la comunidad va desarrollando. Podemos hacer nuestras operaciones con diversas funciones, y no hay una sola forma de hacerlo. Si se trata de funciones que no est√°n predeterminadas en R, debemos instalar el paquete que las contiene con el comando "install.packages()", y antes de ejecutarla debemos abrir la libreria con el comando "library()"

-   Luego de la funci√≥n, se abre un par√©ntesis que contiene los argumentos: instrucciones que especifican ciertos detalles de lo que queramos que la funci√≥n realice. Los argumentos pueden escribirse de distintas maneras y va a depender de lo que queramos hacer. En nuestro ejemplo: El primer argumento indica la informaci√≥n a leer, en este caso indica un archivo de tipo Excel (extensi√≥n xlsx). El segundo argumento indica la hoja del archivo a leer. El tercer argumento indica qu√© columnas se leer√°n de forma espec√≠fica (en este caso, las primeras diez).

**Hagamos un ejemplo:**

Vamos a abrir un archivo en R, utilizando la funci√≥n "import" del paquete "rio", el cual es un paquete vers√°til que nos permite importar datos de diversas extensiones (dta, sav, csv, xls, etc.)

Antes que todo, debemos instalar el paquete escribiendo en la consola: install.packages("rio")

```{r}
library(rio) #Convocamos el paquete   
data=import("Mosteller.csv") #Utilizamos la funci√≥n import (importar) que crear√° un objeto en R que contenga la base de datos del archivo "Mosteller.csv" que hemos descargado. Podemos verificar la creaci√≥n en el environment (ventana derecha superior)

class(data) #si quieren saber que clase de objeto es el que has creado, utilizamos la funci√≥n "class" y entre par√©ntesis colocamos el nombre del objeto. Ver√°n que se trata de un "data frame", es el tipo de objeto en R para las bases de datos.
```

¬øQu√© otro tipo de objetos existen?

#### **3.3. Tipos de objetos en R**

Una parte clave para iniciar el manejo del programa es identificar los diversos objetos que podemos crear, manipular y utilizar. Para la definici√≥n de objetos en R ser√° necesario previamente tener claridad te√≥rica sobre lo que es una variable categ√≥rica nominal, categ√≥rica ordinal, num√©rica discreta y num√©rica continua.

Para los fines de este curso se contemplar√°n las siguientes objetos:

+------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| Tipo                   | Descripci√≥n                                                                                                                            |
+========================+========================================================================================================================================+
| **Vector num√©rico**    | Vector conformado por la concatenaci√≥n de n√∫meros, puede representar variables num√©ricas continuas o discretas. Ej: 1.5 , 2.7 , 3.1    |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| **Vector de factores** | Vector que sirve para representar variables categ√≥ricas.                                                                               |
|                        |                                                                                                                                        |
|                        | Pudiendo ser factores nominales u ordinales. Ej: "costa", "sierra", "selva"                                                            |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------+
| **Data frames**        | Son hojas de datos, estructuras similares a una matriz; sin embargo, a diferencia de estas pueden almacenar objetos de distintos tipo. |
|                        |                                                                                                                                        |
|                        | **Generalmente nuestras bases de datos son de este tipo** (como una hoja de Excel que tiene variables num√©ricas, categ√≥ricas, etc).    |
+------------------------+----------------------------------------------------------------------------------------------------------------------------------------+

Los **vectores num√©ricos** se crean a trav√©s de la funci√≥n **concatenar "c()"**. Vamos a crear un vector que contenga los montos en millones de soles del presupuesto del Estado asignado a las 5 prioridades para el 2021

```{r}
Presupuesto_millones=c(9879, 33132, 20991, 690, 5392) #creamos el vector (verifiquemos en el environment)
Presupuesto_millones #invocamos el vector para visualizar su contenido
```

Un **factor** nos permite representar una variable categ√≥rica. Se crean a trav√©s de la funci√≥n **"factor()"**, pero antes se crea como vector pues almacena las categor√≠as en la forma de un vector con n√∫meros discretos integrales (1,2,3,4,etc.), que son c√≥digos de los valores de la variable y otro vector de caracteres interno que contiene las etiquetas de esos c√≥digos. Creemos un factor con los nombres de las prioridades del presupuesto para el 2021:

```{r}
Prioridad = c(1,2,3,4,5) #primero creamos un vector
Prioridad = factor(Prioridad, levels = c(1:5), labels = c("reactivaci√≥n", "educaci√≥n","salud","mujer","pobreza")) #Lo convertimos en factor. Ojo con los argumentos.
Prioridad #visualizamos su contenido
```

Tambi√©n podemos crear un **factor ordenado** para almacenar informaci√≥n de una variable categ√≥rica ordinal. Es casi la misma ruta, solo que a√±adiremos una funci√≥n m√°s para convertir el factor en ordinal. Creemos un factor ordinal ficticio que contenga el nivel de ejecuci√≥n que el Estado ha mostrado en las categor√≠as presupuestales correspondientes a las prioridades, donde 1=Mala, 2=Intermedia y 3= Buena.

```{r}
Ejecucion=c(3,2,2,1,2) #creamos un vector num√©rico que registra los datos
Ejecucion=factor(Ejecucion) #Lo convertimos en factor
levels(Ejecucion)=c("Mala","Intermedia","Buena") #asignamos los niveles al factor
Ejecucion=ordered(Ejecucion) #indicamos que se trata de un factor ordinal (ordered)
Ejecucion #Visualizamos
```

Finalmente, los **data frames** nos permite almacenar un conjunto de datos, es decir una base de datos (bd) que tiene filas y columnas. Creemos la base de datos "PP2024" que contenga todos los objetos que hemos creado:

```{r}
PP2024 = data.frame(Prioridad,Presupuesto_millones,Ejecucion)
PP2024 # Visualice la base de datos
str(PP2024) # Visualice la estructura de la BD
names(PP2024) #Visualice los nombres de las variables de la BD
```

Cuando queramos invocar una variable espec√≠fica de una base de datos utilizaremos **"\$"**, entre la base de datos y la variable que queremos invocar.

```{r}
PP2024$Prioridad #invocamos la variable prioridad de la base de datos
class(PP2024$Ejecucion) #vemos de que clase es la variable ejecuci√≥n de la bbdd
```

------------------------------------------------------------------------

<a id='part4'></a>

# **4. An√°lisis descriptivo en R**

Mosteller (1995)[^1] realiz√≥ un estudio longitudinal sobre el impacto del tama√±o de la clase en los primeros grados escolares, sobre el desempe√±o estudiantil y el desarrollo personal.

[^1]: *M√°s informaci√≥n del art√≠culo al siguiente [link](https://pubmed.ncbi.nlm.nih.gov/8528684/)*

**A tomar en cuenta**

-   Un estudio longitudinal es aquel en el que se hace un seguimiento a participantes a lo largo del tiempo.

<!-- -->

-   Este estudio en concreto dur√≥ de 1985 a 1989 y participaron 11,601 estudiantes.

-   Durante los cuatro a√±os del estudio, los estudiantes fueron asignados aleatoriamente a clases peque√±as, a clases de tama√±o normal o a clases de tama√±o normal con ayuda.

Aunque el programa se detuvo en 1989 despu√©s de que la primera clase de jard√≠n de infancia del programa terminara el tercer grado, la recopilaci√≥n de informaci√≥n (por ejemplo, el rendimiento en los ex√°menes de octavo grado, el promedio general de la escuela secundaria) continu√≥ hasta el final de la asistencia de los participantes a la escuela secundaria. *Para esta sesi√≥n **no** vamos a examinar las hip√≥tesis o resultados del trabajo de Mosteller (1995), pero s√≠ vamos a utilizar parte de su base de datos para el an√°lisis descriptivo* üòå

> **¬øPor qu√© son importantes este tipo de estudios desde las ciencias sociales ?**
>
> ![](pd1_kermit.png "porq es importante?"){width="117"}

**¬°Manos a la obra!**

Importamos nuestra base de datos

```{r, results="hide"}
library(rio)    
data=import("Mosteller.csv") 
```

Exploramos las variables que tiene nuestra base de datos:

-   chr, factor -\> variable nominal

-   ordered factor -\> variable ordinal

-   num, int -\> variable num√©rica

```{r}
names(data)
str(data)
```

El contenido de cada variable lo podemos ver en la siguiente tabla:

```{r,echo=FALSE, out.width="60%",fig.align="center"}
knitr::include_graphics("diccionario.png")
```

## 4.1. Formateo de variables y frecuencia

Siempre antes de comenzar a realizar nuestro an√°lisis, debemos identificar la estructura de las variables y verificar que est√©n bien "configuradas". Es decir que la escala de la variable coincida con el objeto en R.

Por ejemplo, debemos asegurarnos que una variable categ√≥rica no est√© configurada como num√©rica en R, y viceversa.

**Variable "race"** Exploramos frecuencias

```{r, message=FALSE}
library(tidyverse) #no olvidar llamar a la librer√≠a

data %>%
 group_by(race) %>%
  summarize(Freq=n())
```

Exploramos el formato de la variable

```{r}
class(data$race) 
```

Categorizamos

```{r}
data$race = factor(data$race, levels = c(1:6), labels = c("white","black","asian","hispanic","native american","others")) #Otorgamos formato; "factor" quiere decir que se otorga formato de variable categ√≥rica

class(data$race)
```

```{r}
data %>%
 group_by(race) %>%
  summarize(Freq=n())
```

La tabla anterior se llama **tabla de frecuencias**, y nos permite observar cu√°ntas observaciones existen por cada variable.

En el caso anterior, la tabla nos indica que, de todas las personas estudiadas, 1383 se identificaron como *white*, 211 como *black*, 5 como *asian* y 1 como *others*. Asimismo, se observa que nadie se identific√≥ como *native american* ni *hispanic*.

Asimismo, podemos explorar las frecuencias de manera gr√°fica con la ayuda del paquete `ggplot2` . Para ello, antes debemos de crear una tabla y crear un objeto, lo llamaremos *para_grafico*

```{r}

para_graficoRace=data %>%
 group_by(race) %>%
  summarize(Freq=n())

```

Si no contamos con el paquete ggplot lo instalamos insertando el siguiente c√≥digo en un chunk: `install.packages("ggplot2")`

```{r}
library(ggplot2)
ggplot(para_graficoRace, aes(x=race, y=Freq, fill=race)) + 
geom_bar(stat = "identity") 
```

Podemos personalizar el gr√°fico :)

```{r}
library(ggplot2)
ggplot(para_graficoRace, aes(x=race, y=Freq, fill=race)) + 
geom_bar(stat = "identity")+
  ggtitle("Distribuci√≥n de autopercepci√≥n") +
  xlab("Race") + ylab("Frecuencia")+
  geom_text(aes(label=round(Freq,1)), vjust=1.30, color="black", size=3)+
  theme(panel.background=element_rect(fill = "white", colour = "white"))
```

**Variable "classtype":**

```{r}
class(data$classtype) 

data %>%
 group_by(classtype) %>%
  summarize(Freq=n())
```

```{r}
data$classtype = factor(data$classtype, levels = c(1:3), labels = c("small","regular","regular with aid"))#"factor" para variable nominal

str(data$classtype)

```

```{r}
data %>%
 group_by(classtype) %>%
  summarize(Freq=n())#tabla de frecuencias
```

Al igual que con la tabla anterior, en este caso la \*\*tabla de frecuencia\* nos indica que, de los encuestados, 481 pertenecen a una clase peque√±a, 578 pertenecen a una clase regular y otros 541 pertenecen a una clase regular con ayuda. Tambi√©n lo podemos ver en gr√°fico con el paquete ggplot2

```{r}
para_graficoClass=data %>%
 group_by(classtype) %>%
  summarize(Freq=n())#tabla de frecuencias
```

```{r}
library(ggplot2)
ggplot(para_graficoClass, aes(x=classtype, y=Freq, fill=classtype)) + 
geom_bar(stat = "identity")+
  
  ggtitle("Distribuci√≥n de tipo de clase") +
  xlab("Tipo de clase") + ylab("Frecuencia")+
  geom_text(aes(label=round(Freq,1)), vjust=1.30, color="black", size=3)+
  scale_fill_brewer(name="Tipo de Clase",palette="Pastel1")+
  theme(panel.background=element_rect(fill = "white", colour = "white"))
```

**De "hsgrad"**

```{r}
class(data$hsgrad)
```

```{r}
data$hsgrad = factor(data$hsgrad, levels = c(0:1), labels = c("did not graduate","did graduate")) #ojo con el orden

str(data$hsgrad)#confirmamos la modificaci√≥n
```

```{r}
data %>%
 group_by(hsgrad) %>%
  summarize(Freq=n())#tabla de frecuencias
```

```{r}
para_graficoHs=data %>%
 group_by(hsgrad) %>%
  summarize(Freq=n())#tabla de frecuencias
```

```{r}
library(ggplot2)
ggplot(para_graficoHs, aes(x=hsgrad, y=Freq, fill=hsgrad)) + 
geom_bar(stat = "identity")+
  
  ggtitle("Distribuci√≥n de graduados") +
  xlab("Tipo de clase") + ylab("Frecuencia")+
  scale_fill_brewer(name=" ",palette="Dark2")+
  geom_text(aes(label=round(Freq,1)), vjust=1.30, color="black", size=3)+
  theme(panel.background=element_rect(fill = "white", colour = "white"))
```

En este caso, nuestra tabla nos indica que, de todas las personas estudiadas, 1442 personas consiguieron graduarse, mientras que otras 158 no lo consiguieron.

**"g4math", "g4reading", "yearssmall"** son variables num√©ricas y est√°n configuradas como vectores num√©ricos de n√∫meros enteros (integer), por lo cual lo dejamos as√≠ üò∏.

## 4.2 Media y mediana

Entonces, una vez configurados adecuadamente nuestros **objetos**, pidamos los estad√≠sticos de tendencia central para nuestras variables.

Antes instalamos algunos paquetes que utilizaremos

-   **install.packages("DescTools")** para pedir los estad√≠sticos de tendencia central

Las variables solicitadas son classtype y hsgrad

**Para "g4math" podemos:**

```{r}
library(DescTools)
library(tidyverse)

data %>% summarise(media = mean(g4math)) #este comando nos permitir√° calcular la media. Consejo: leer este comando de derecha a izquierda
```

**Para "g4math" podemos:**

```{r}
library(DescTools)
data %>% summarise(mediana = median(g4math)) #calcular la mediana. Al igual que con la media, se sugiere leer el comando de derecha a izquierda.
```

------------------------------------------------------------------------

#### Ejercicio: Calculemos la media y la mediana de la variable "g4reading"

<br></br> [Go to page beginning](#beginning)
