---
title: "Pr치ctica dirigida 5"
output:
  html_document:
    toc: yes
    toc_float: yes
    collapsed: no
    number_sections: no
    toc_depth: 3
    theme: cosmo
    highlight: textmate
    always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

**FACULTAD DE CIENCIAS SOCIALES - PUCP**<br>

## Curso: POL 278 - Estad칤stica para el an치lisis pol칤tico 1 \| Semestre 2024 - 1 <br>

<center><img src=" " width="200"/></center>

```{r,echo=FALSE, out.width="30%"}
knitr::include_graphics("logoPUCP.png") 
```

# Intervalos de confianza para la media

```{=html}
<style>
.custom-text {
  color: #00688B;
  font-family: Helvetica, sans-serif;
  text-align: center;
  font-weight: bold;
  font-size: 22px;
}
</style>
```
::: custom-text
쮼xiste diferencia de percepciones sobre la calidad del servicio de la PNP en los distintos niveles de estratos y regiones en el 2023? 游뱂
:::

Llamemos a los paquetes

```{r}
library(rio)
library(lsr)
library(dplyr)
library(ggplot2)
```

Importemos la base de datos

```{r}
data=import("Endo-2021-sub.sav")
```

FALTA
```{r,echo=FALSE, out.width="80%"}
knitr::include_graphics("diccionario-endo.png") 
```

Revisemos nuestra base

```{r, include=TRUE, eval=FALSE}
str(data)
names(data)
```

## **1. 쮺칩mo defino calidad del servicio de la PNP?**

**Indicador proxy**

Para el intervalo de confianza para la media crearemos el indicador: **percepci칩n de facilidad de labor docente, este indicador debe ir del 0 al 10**. Para ello nos basaremos en cinco variables que responden a "En una escala del 1 al 4, donde 1 es"Muy dif칤cil" y 4 - "Muy f치cil 쯈u칠 tan facil o dif칤cil es realizar las siguientes actividades vinculadas al quehacer docente?"

| Nombre de variable |                                                                Etiqueta                                                                |
|:-------------:|:-------------------------------------------------------:|
|      P1_27_A       |                       쯈u칠 tan f치cil o dif칤cil es comunicarse y retroalimentar y motivar a las y los estudiante                        |
|      P1_27_B       |                                   쮸tender los problemas socioemocionales de las y los estudiantes?                                    |
|      P1_27_C       | 쯌irtualizar la ense침anza, adaptando y/o complementando las sesiones de "Aprendo en casa", seg칰n necesidades de las y los estudiantes? |
|      P1_27_D       |                                 쮺oordinar y responder a la demanda de los padres y madres de familia?                                 |
|      P1_27_E       |                쯇lanificar actividades bajo el enfoque por competencias del Curr칤culo Nacional de la Educaci칩n B치sica?                 |

### Recordemos los pasos para construir un indicador:

1.  Verificar que las variables correspondan al concepto.
2.  Revisar el sentido de las categor칤as en el cuestionario/diccionario
3.  Si las categor칤as est치n en el correcto sentido, proceder a sumarlas; si no lo est치n, proceder a recodificarlas para luego sumar. **Recuerda que para sumarlas deben ser variables tipo num칠ricas.**
4.  Realizar suma de las variables a analizar
5.  Aplicar la funci칩n rescale con el rango espec칤fico

Ya hab칤amos revisado previamente que las variables si est치n como num칠ricas.

```{r}
data = data %>%
  mutate(suma=P1_27_A+P1_27_B+P1_27_C+P1_27_D+P1_27_E) #creamos la suma 
summary(data$suma) #identifico m칤nimo y m치ximo

```

Creamos el indicador

```{r}

library(scales)
data = data %>%
  mutate(indicador = ((suma-5)/15)*10) #le restamos el m칤nimo y dividimos entre 20-5


#Lo multiplicamos por 10 porque queremos que vaya hasta 10

  summary(data$indicador)#revisamos que se haya creado bien el indicador

```

## **2. 쮺u치l es la media de la calidad del servicio de la PNP a una certeza del 95%?**

```{r}
ic_media = ciMean(data$indicador,na.rm = TRUE)
ic_media
```

Nuestra media poblacional se encuentra entre 4.9 y 5. Esto quiere decir que tenemos una certeza del 95% de que el valor poblacional de la **percepci칩n de facilidad de labor docente** se encuentra entre 4.9 y 5. Lo que se encuentra muy cercano al punto medio del indicador (5).

# **3.쮼xisten diferencias entre las medias de los niveles de estratos econ칩micos?**

Tengamos en consideraci칩n que para poder hallar el intervalo de confianza para una proporci칩n debemos determinar nuestro caso de 칠xito. Asimismo, para hallar el intervalo de confianza para una proporci칩n nuestra variable debe ser categ칩rica y debe representar una variable dicot칩mica; es decir, una variable con solo dos categor칤as posibles.

*Hallemos el intervalo de confianza para la proporci칩n de los docentes que tienen una ocupaci칩n adicional que genere ingresos (P1_16 1-Si, 2-No).*

Necesitamos tener muy claro la frecuencia de nuestro caso de 칠xito (1) y del total de casos.

```{r}
table(data$P1_16)
```

*Nuestro caso de 칠xito es haber recibido este tipo de apoyo, por lo tanto el primer argumento que ingresaremos en el prop.test es 2471. Por otro lado, el total de casos es 2471 + 16436. Con eso claro, procedamos a calcular el intervalo de confianza.*

```{r}
x = 2471 #almacenamos en "x" la frecuencia de nuestro caso de 칠xito
n = 2471 + 16436 #almacenamos en "n" el total de casos
```

Hallamos el invervalo de confianza para una proporci칩n con el comando **prop.test**

```{r}
ic_prop = prop.test(x,n)
ic_prop #llamamos a ic_prop para visualizar los resultados
```

Lo que hallamos nos permite afirmar con un 95% de confianza que, a nivel poblacional, el porcentaje de docentes que cuentan con una ocupaci칩n adicional que genera ingresos se encuentra entre 12.6% y 13.6%.

# **#3.쮼xisten diferencias entre las medias de los niveles de estratos econ칩micos?**

Hallemos el intervalo de confianza para el indicador de percepci칩n de facilidad de labor docente, seg칰n el dominio geogr치fico. En este caso, queremos comparar seg칰n si son de la costa, sierra o selva. Para ello debemos dejar fuera a los casos de Lima Metropolitana y crear una nueva variable (region) que se base en dominio geogr치fico y realizar los siguientes cambios si es costa norte, coste centro o costa sur que se convierta en costa, si es selva que siga siendo selva y si es sierra norte, sierra centro o sierra sur que se convierta en sierra.

```{r}
data = data %>%
  filter(!(dominio_geografico == "LIMA METROPOLITANA"))%>%
  mutate(region = case_when(dominio_geografico == "COSTA NORTE"|dominio_geografico == "COSTA CENTRO"| dominio_geografico == "COSTA SUR" ~ "COSTA",
                            dominio_geografico == "SELVA" ~ "SELVA",
                            dominio_geografico == "SIERRA NORTE"|dominio_geografico == "SIERRA CENTRO"| dominio_geografico == "SIERRA SUR" ~ "SIERRA"))

```

```{r}
#VERSI칍N CORTA
#data = data %>%
#  filter(!(dominio_geografico == "LIMA METROPOLITANA"))%>%
#  mutate(region = case_when(dominio_geografico %in% c("COSTA NORTE","COSTA CENTRO","COSTA SUR") ~ "COSTA",
#                            dominio_geografico == "SELVA" ~ "SELVA",
#                            T ~ "SIERRA"))
```

Revisemos que nuestros datos se hayan asignado bien

```{r}
table(data$dominio_geografico)
table(data$region)
```

Ahora si procedemos a calcular el intervalo de confianza para la media del indicador de percepci칩n de facilidad de labor docente seg칰n region.

```{r}
ic_grupo = data %>%
  group_by(region) %>%
  summarise(Media = mean(indicador, na.rm=T),
            min = ciMean(indicador, na.rm=T)[1],
            max = ciMean(indicador, na.rm=T)[2]
            )
ic_grupo
```

Seg칰n nuestra tabla, podemos afirmar que hay un 95% de probabilidad de que a nivel poblacional la media de los docentes de la sierra perciben una menor facilidad en sus labores. Mientras que los de la costa perciben sus labores como m치s sencillas. Veamos el gr치fico para complementar esta afirmaci칩n.

```{r}
ggplot(ic_grupo, aes(x= region, y =Media)) +
  geom_errorbar(aes(ymin=min, ymax=max), width = 0.2)+
   geom_text(aes(label=paste(round(Media, 2))), size=4)+
  xlab("Regi칩n") + ylab("Indicador de percepci칩n de facilidad de labor docente")+
  theme_bw()
```

Debemos que buscar traslape entre las barras, en este caso podemos reafirmar que los docentes de la sierra perciben una menor facilidad en sus labores a comparaci칩n de los de la selva o costa. Por otro lado, los docentes de la selva, perciben mayor facilidad que los de la sierra, pero menor que los de la costa. A pesar de estar muy cercanas sus barras, sabemos que no hay traslape por la anterior tabla. Esta nos indicaba que el l칤mite superior de selva es de 5.11; mientras que el l칤mite inferior de costa es de 5.12.

## Ejercicio

1.  Calcular el intervalo de confianza para la media de la variable que mide el tiempo invertido en preparar las clase y labores administrativas de lunes a viernes (P1_9_A_LV_MIN)

```{r}
str(data$P1_9_A_LV_MIN)
```

2.  Calcular el intervalo de confianza para la proporci칩n de personas que recibieron apoyo psicol칩gico y/o emocional (P1_13)

3.  Calcula el intervalo de confianza para la media de la variable P1_9_A_LV_MIN seg칰n sexo (P1_1)
